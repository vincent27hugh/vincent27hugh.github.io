<!DOCTYPE html>



  


<html class="theme-next mist use-motion" lang="en">
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="theme-color" content="#222">






  
  
  <link rel="stylesheet" media="all" href="/lib/Han/dist/han.min.css?v=3.3">




<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css">




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=5.1.2" rel="stylesheet" type="text/css">


  <meta name="keywords" content="rmarkdown,rlang,experiment,monte_carlo,famafrench,statistics,">





  <link rel="alternate" href="/atom.xml" title="NEVERLAND夢幻島" type="application/atom+xml">




  <link rel="shortcut icon" type="image/x-icon" href="/favicon.jpg?v=5.1.2">






<meta name="description" content="We use Monte Carlo simulations to validate the Fama-French five-factor model and the O.L.S properties">
<meta name="keywords" content="rmarkdown,rlang,experiment,monte_carlo,famafrench,statistics">
<meta property="og:type" content="article">
<meta property="og:title" content="Monte Carlo Experiment for Fama French 5 Factor Model">
<meta property="og:url" content="http://blog.baoduge.com/MC_FF5/index.html">
<meta property="og:site_name" content="NEVERLAND夢幻島">
<meta property="og:description" content="We use Monte Carlo simulations to validate the Fama-French five-factor model and the O.L.S properties">
<meta property="og:locale" content="en">
<meta property="og:image" content="http://blog.baoduge.com/images/MC_FF5_files/figure-markdown_github/unnamed-chunk-4-1.png">
<meta property="og:image" content="http://blog.baoduge.com/images/MC_FF5_files/figure-markdown_github/unnamed-chunk-4-2.png">
<meta property="og:image" content="http://blog.baoduge.com/images/MC_FF5_files/figure-markdown_github/unnamed-chunk-4-3.png">
<meta property="og:image" content="http://blog.baoduge.com/images/MC_FF5_files/figure-markdown_github/unnamed-chunk-4-4.png">
<meta property="og:image" content="http://blog.baoduge.com/images/MC_FF5_files/figure-markdown_github/unnamed-chunk-4-5.png">
<meta property="og:image" content="http://blog.baoduge.com/images/MC_FF5_files/figure-markdown_github/unnamed-chunk-4-6.png">
<meta property="og:image" content="http://blog.baoduge.com/images/MC_FF5_files/figure-markdown_github/unnamed-chunk-4-7.png">
<meta property="og:image" content="http://blog.baoduge.com/images/MC_FF5_files/figure-markdown_github/unnamed-chunk-4-8.png">
<meta property="og:image" content="http://blog.baoduge.com/images/MC_FF5_files/figure-markdown_github/unnamed-chunk-4-9.png">
<meta property="og:image" content="http://blog.baoduge.com/images/MC_FF5_files/figure-markdown_github/unnamed-chunk-4-10.png">
<meta property="og:image" content="http://blog.baoduge.com/images/MC_FF5_files/figure-markdown_github/unnamed-chunk-4-11.png">
<meta property="og:image" content="http://blog.baoduge.com/images/MC_FF5_files/figure-markdown_github/unnamed-chunk-4-12.png">
<meta property="og:image" content="http://blog.baoduge.com/images/MC_FF5_files/figure-markdown_github/unnamed-chunk-4-13.png">
<meta property="og:image" content="http://blog.baoduge.com/images/MC_FF5_files/figure-markdown_github/unnamed-chunk-4-14.png">
<meta property="og:image" content="http://blog.baoduge.com/images/MC_FF5_files/figure-markdown_github/unnamed-chunk-4-15.png">
<meta property="og:image" content="http://blog.baoduge.com/images/MC_FF5_files/figure-markdown_github/unnamed-chunk-4-16.png">
<meta property="og:image" content="http://blog.baoduge.com/images/MC_FF5_files/figure-markdown_github/unnamed-chunk-4-17.png">
<meta property="og:image" content="http://blog.baoduge.com/images/MC_FF5_files/figure-markdown_github/unnamed-chunk-6-1.png">
<meta property="og:image" content="http://blog.baoduge.com/images/MC_FF5_files/figure-markdown_github/unnamed-chunk-12-1.png">
<meta property="og:image" content="http://blog.baoduge.com/images/MC_FF5_files/figure-markdown_github/unnamed-chunk-12-2.png">
<meta property="og:image" content="http://blog.baoduge.com/images/MC_FF5_files/figure-markdown_github/unnamed-chunk-12-3.png">
<meta property="og:image" content="http://blog.baoduge.com/images/MC_FF5_files/figure-markdown_github/unnamed-chunk-12-4.png">
<meta property="og:image" content="http://blog.baoduge.com/images/MC_FF5_files/figure-markdown_github/unnamed-chunk-12-5.png">
<meta property="og:image" content="http://blog.baoduge.com/images/MC_FF5_files/figure-markdown_github/unnamed-chunk-12-6.png">
<meta property="og:image" content="http://blog.baoduge.com/images/MC_FF5_files/figure-markdown_github/unnamed-chunk-13-1.png">
<meta property="og:image" content="http://blog.baoduge.com/images/MC_FF5_files/figure-markdown_github/unnamed-chunk-13-2.png">
<meta property="og:image" content="http://blog.baoduge.com/images/MC_FF5_files/figure-markdown_github/unnamed-chunk-13-3.png">
<meta property="og:image" content="http://blog.baoduge.com/images/MC_FF5_files/figure-markdown_github/unnamed-chunk-13-4.png">
<meta property="og:image" content="http://blog.baoduge.com/images/MC_FF5_files/figure-markdown_github/unnamed-chunk-13-5.png">
<meta property="og:image" content="http://blog.baoduge.com/images/MC_FF5_files/figure-markdown_github/unnamed-chunk-13-6.png">
<meta property="og:image" content="http://blog.baoduge.com/images/MC_FF5_files/figure-markdown_github/unnamed-chunk-14-1.png">
<meta property="og:image" content="http://blog.baoduge.com/images/MC_FF5_files/figure-markdown_github/unnamed-chunk-16-1.png">
<meta property="og:image" content="http://blog.baoduge.com/images/MC_FF5_files/figure-markdown_github/unnamed-chunk-16-2.png">
<meta property="og:image" content="http://blog.baoduge.com/images/MC_FF5_files/figure-markdown_github/unnamed-chunk-16-3.png">
<meta property="og:image" content="http://blog.baoduge.com/images/MC_FF5_files/figure-markdown_github/unnamed-chunk-16-4.png">
<meta property="og:image" content="http://blog.baoduge.com/images/MC_FF5_files/figure-markdown_github/unnamed-chunk-16-5.png">
<meta property="og:image" content="http://blog.baoduge.com/images/MC_FF5_files/figure-markdown_github/unnamed-chunk-16-6.png">
<meta property="og:image" content="http://blog.baoduge.com/images/MC_FF5_files/figure-markdown_github/unnamed-chunk-18-1.png">
<meta property="og:image" content="http://blog.baoduge.com/images/MC_FF5_files/figure-markdown_github/unnamed-chunk-20-1.png">
<meta property="og:image" content="http://blog.baoduge.com/images/MC_FF5_files/figure-markdown_github/unnamed-chunk-20-2.png">
<meta property="og:image" content="http://blog.baoduge.com/images/MC_FF5_files/figure-markdown_github/unnamed-chunk-20-3.png">
<meta property="og:image" content="http://blog.baoduge.com/images/MC_FF5_files/figure-markdown_github/unnamed-chunk-20-4.png">
<meta property="og:image" content="http://blog.baoduge.com/images/MC_FF5_files/figure-markdown_github/unnamed-chunk-20-5.png">
<meta property="og:image" content="http://blog.baoduge.com/images/MC_FF5_files/figure-markdown_github/unnamed-chunk-20-6.png">
<meta property="og:image" content="http://blog.baoduge.com/images/MC_FF5_files/figure-markdown_github/unnamed-chunk-21-1.png">
<meta property="og:image" content="http://blog.baoduge.com/images/MC_FF5_files/figure-markdown_github/unnamed-chunk-23-1.png">
<meta property="og:image" content="http://blog.baoduge.com/images/MC_FF5_files/figure-markdown_github/unnamed-chunk-23-2.png">
<meta property="og:image" content="http://blog.baoduge.com/images/MC_FF5_files/figure-markdown_github/unnamed-chunk-23-3.png">
<meta property="og:image" content="http://blog.baoduge.com/images/MC_FF5_files/figure-markdown_github/unnamed-chunk-23-4.png">
<meta property="og:image" content="http://blog.baoduge.com/images/MC_FF5_files/figure-markdown_github/unnamed-chunk-23-5.png">
<meta property="og:image" content="http://blog.baoduge.com/images/MC_FF5_files/figure-markdown_github/unnamed-chunk-23-6.png">
<meta property="og:image" content="http://blog.baoduge.com/images/MC_FF5_files/figure-markdown_github/unnamed-chunk-24-1.png">
<meta property="og:image" content="http://blog.baoduge.com/images/MC_FF5_files/figure-markdown_github/unnamed-chunk-26-1.png">
<meta property="og:image" content="http://blog.baoduge.com/images/MC_FF5_files/figure-markdown_github/unnamed-chunk-26-2.png">
<meta property="og:image" content="http://blog.baoduge.com/images/MC_FF5_files/figure-markdown_github/unnamed-chunk-26-3.png">
<meta property="og:image" content="http://blog.baoduge.com/images/MC_FF5_files/figure-markdown_github/unnamed-chunk-26-4.png">
<meta property="og:image" content="http://blog.baoduge.com/images/MC_FF5_files/figure-markdown_github/unnamed-chunk-26-5.png">
<meta property="og:image" content="http://blog.baoduge.com/images/MC_FF5_files/figure-markdown_github/unnamed-chunk-26-6.png">
<meta property="og:image" content="http://blog.baoduge.com/images/MC_FF5_files/figure-markdown_github/unnamed-chunk-27-1.png">
<meta property="og:image" content="http://blog.baoduge.com/images/MC_FF5_files/figure-markdown_github/unnamed-chunk-29-1.png">
<meta property="og:image" content="http://blog.baoduge.com/images/MC_FF5_files/figure-markdown_github/unnamed-chunk-29-2.png">
<meta property="og:image" content="http://blog.baoduge.com/images/MC_FF5_files/figure-markdown_github/unnamed-chunk-29-3.png">
<meta property="og:image" content="http://blog.baoduge.com/images/MC_FF5_files/figure-markdown_github/unnamed-chunk-29-4.png">
<meta property="og:image" content="http://blog.baoduge.com/images/MC_FF5_files/figure-markdown_github/unnamed-chunk-29-5.png">
<meta property="og:image" content="http://blog.baoduge.com/images/MC_FF5_files/figure-markdown_github/unnamed-chunk-30-1.png">
<meta property="og:image" content="http://blog.baoduge.com/images/MC_FF5_files/figure-markdown_github/unnamed-chunk-32-1.png">
<meta property="og:image" content="http://blog.baoduge.com/images/MC_FF5_files/figure-markdown_github/unnamed-chunk-32-2.png">
<meta property="og:image" content="http://blog.baoduge.com/images/MC_FF5_files/figure-markdown_github/unnamed-chunk-32-3.png">
<meta property="og:image" content="http://blog.baoduge.com/images/MC_FF5_files/figure-markdown_github/unnamed-chunk-32-4.png">
<meta property="og:image" content="http://blog.baoduge.com/images/MC_FF5_files/figure-markdown_github/unnamed-chunk-32-5.png">
<meta property="og:image" content="http://blog.baoduge.com/images/MC_FF5_files/figure-markdown_github/unnamed-chunk-33-1.png">
<meta property="og:image" content="http://blog.baoduge.com/images/MC_FF5_files/figure-markdown_github/unnamed-chunk-35-1.png">
<meta property="og:updated_time" content="2018-05-11T15:26:14.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Monte Carlo Experiment for Fama French 5 Factor Model">
<meta name="twitter:description" content="We use Monte Carlo simulations to validate the Fama-French five-factor model and the O.L.S properties">
<meta name="twitter:image" content="http://blog.baoduge.com/images/MC_FF5_files/figure-markdown_github/unnamed-chunk-4-1.png">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Mist',
    version: '5.1.2',
    sidebar: {"position":"left","display":"always","offset":12,"offset_float":12,"b2t":true,"scrollpercent":true,"onmobile":true},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn"}},
    duoshuo: {
      userId: '0',
      author: 'Author'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://blog.baoduge.com/MC_FF5/">





  <title>Monte Carlo Experiment for Fama French 5 Factor Model | NEVERLAND夢幻島</title>
  








</head>

<body itemscope="" itemtype="http://schema.org/WebPage" lang="en">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope="" itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">NEVERLAND夢幻島</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <h1 class="site-subtitle" itemprop="description">Welcome!</h1>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br>
            
            Home
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br>
            
            About
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br>
            
            Categories
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br>
            
            Tags
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br>
            
            Archives
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br>
            
            Search
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off" placeholder="Searching..." spellcheck="false" type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://blog.baoduge.com/MC_FF5/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="BaoDuGe_飽蠹閣">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="http://baoduge.com/My/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="NEVERLAND夢幻島">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">Monte Carlo Experiment for Fama French 5 Factor Model</h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-04-02T00:00:00+08:00">
                2018-04-02
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/English/" itemprop="url" rel="index">
                    <span itemprop="name">English</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/MC_FF5/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count" data-disqus-identifier="MC_FF5/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          
             <span id="/MC_FF5/" class="leancloud_visitors" data-flag-title="Monte Carlo Experiment for Fama French 5 Factor Model">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">Visitors&#58;</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          
            <span class="post-meta-divider">|</span>
            <span class="page-pv"><i class="fa fa-file-o"></i>
            <span class="busuanzi-value" id="busuanzi_value_page_pv"></span>
            </span>
          

          

          
              <div class="post-description">
                  We use Monte Carlo simulations to validate the Fama-French five-factor model and the O.L.S properties
              </div>
          

        </div>
      </header>
    

    
    
    
    <div class="post-body han-init-context" itemprop="articleBody">

      
      

      
        <script src="/assets/js/APlayer.min.js"> </script><h1 id="Model"><a href="#Model" class="headerlink" title="Model"></a>Model</h1><p>In this post, we use Monte Carlo simulations to validate the Fama-French five-factor model and the O.L.S properties. We confirm the validity of five factors in the Fama-French model, and uncover some interesting findings of O.L.S properties.</p>
<p>Wikipedia: <a href="https://en.wikipedia.org/wiki/Fama%E2%80%93French_three-factor_model" target="_blank" rel="noopener">Fama&#x2013;French model</a></p>
<script type="math/tex; mode=display">r - R_f = \beta_1 + \beta_2 (K_m - R_f) + \beta_3 \cdot SMB + \beta_4 \cdot HML + \beta_5 \cdot RMW + \beta_6 \cdot CMA</script><ul>
<li>$r$ is the portfolio&#x2019;s expected rate of return</li>
<li>$R_f$ is the risk-free return rate</li>
<li>$K_m$ is the return of the market portfolio</li>
</ul>
<p>The &#x201C;five factor&#x201D; $\beta_2$ to $\beta_6$ are:</p>
<ul>
<li>SMB (Small [market capitalization] Minus Big) is the average return on the nine small stock portfolios minus the average return on the nine big stock portfolios;</li>
<li>HML (High [book-to-market ratio] Minus Low) is the average return on the two value portfolios minus the average return on the two growth portfolios;</li>
<li>RMW (Robust Minus Weak) is the average return on the two robust operating profitability portfolios minus the average return on the two weak operating profitability portfolios;</li>
<li>CMA (Conservative Minus Aggressive) is the average return on the two conservative investment portfolios minus the average return on the two aggressive investment portfolios.</li>
</ul>
<p>They measure the historic excess returns of small caps over big caps and of value stocks over growth stocks.</p>
<p>These factors are calculated with combinations of portfolios composed by ranked stocks (BtM ranking, Cap ranking) and available historical market data. Historical values may be accessed on Kenneth French&#x2019;s web page.</p>
<p>Here is <a href="http://mba.tuck.dartmouth.edu/pages/faculty/ken.french/Data_Library/f-f_5_factors_2x3.html" target="_blank" rel="noopener">Description of Fama/French 5 Factors (2x3)</a></p>
<h1 id="Data-Source"><a href="#Data-Source" class="headerlink" title="Data Source"></a>Data Source</h1><p>Data is downloaded from <a href="http://mba.tuck.dartmouth.edu/pages/faculty/ken.french/data_library.html" target="_blank" rel="noopener">homepage of Kenneth R. French</a>.</p>
<h2 id="Fama-French-3-Factors-Daily"><a href="#Fama-French-3-Factors-Daily" class="headerlink" title="Fama/French 3 Factors [Daily]"></a>Fama/French 3 Factors [Daily]</h2><p>This file was created by CMPT_ME_BEME_RETS using the 201801 CRSP database. The 1-month TBill return is from Ibbotson and Associates, Inc.</p>
<h2 id="Portfolios-Formed-on-Book-to-Market-Daily"><a href="#Portfolios-Formed-on-Book-to-Market-Daily" class="headerlink" title="Portfolios Formed on Book-to-Market [Daily]"></a>Portfolios Formed on Book-to-Market [Daily]</h2><p>This file was created by CMPT_BEME_RETS_DAILY using the 201801 CRSP database. It contains value- and equal-weighted returns for portfolios formed on BE/ME. The portfolios are constructed at the end of June. BE/ME is book equity at the last fiscal year end of the prior calendar year divided by ME at the end of December of the prior year. The annual returns are from January to December. Missing data are indicated by -99.99 or -999. The break points use Compustat firms plus the firms hand-collected from the Moodys Industrial, Utilities, Transportation, and Financial Manuals. The break points include utilities. The portfolios use Compustat firms plus the firms hand-collected from the Moodys Industrial, Utilities, Transportation, and Financial Manuals. The portfolios include utilities.</p>
<p>These portfolios are created by doing the following:</p>
<ol>
<li>Rank all stocks that trade on NYSE, Nasdaq and Amex (when it existed) by their book-to-marketratios</li>
<li>Take the bottom 30% and put them into a portfolio (low 30%)</li>
<li>Take the next 40% and put them into a portfolio (medium 40%)</li>
<li>Take the top 30% and put them into a portfolio (top 30%)</li>
<li>Portfolio weights within each portfolio are value-weights</li>
</ol>
<h1 id="Load-Data"><a href="#Load-Data" class="headerlink" title="Load Data"></a>Load Data</h1><p>Here is our data:</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">rm(list=ls())</span><br><span class="line"><span class="comment"># Load data file into R</span></span><br><span class="line">load(file=<span class="string">&quot;5factors_2008_2018.RData&quot;</span>)</span><br><span class="line">dim(mydata2)</span><br></pre></td></tr></table></figure>
<pre><code>## [1] 2518   26
</code></pre><h2 id="Extract-Fama-French-Factors-and-Fund-Returns"><a href="#Extract-Fama-French-Factors-and-Fund-Returns" class="headerlink" title="Extract Fama-French Factors and Fund Returns"></a>Extract Fama-French Factors and Fund Returns</h2><ul>
<li><code>rmrf</code>: <em>K</em><sub><em>m</em></sub>&#x2005;&#x2212;&#x2005;<em>R</em><sub><em>f</em></sub></li>
<li><code>smb</code>: SMB</li>
<li><code>hml</code>: HML</li>
<li><code>rmw</code>: RMW</li>
<li><code>cma</code>: CMA</li>
<li><code>rf</code>: <em>R</em><sub><em>f</em></sub></li>
<li><code>lo_30</code>: <em>r</em>, the portfolio&#x2019;s expected rate of return. Here, we choose <strong>the portfolio with firms of lowest 30% value- and equal-weighted returns</strong>.</li>
</ul>
<p>Now, we extract Fama-French Factors and Fund Returns from dataset:</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mydate &lt;- mydata2$Date</span><br><span class="line">range(mydate)</span><br></pre></td></tr></table></figure>
<pre><code>## [1] &quot;2008-01-02&quot; &quot;2017-12-29&quot;
</code></pre><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">rmrf &lt;- mydata2$Mkt.RF</span><br><span class="line">smb &lt;- mydata2$SMB</span><br><span class="line">hml &lt;- mydata2$HML</span><br><span class="line">rf &lt;- mydata2$RF</span><br><span class="line">rmw &lt;- mydata2$RMW</span><br><span class="line">cma &lt;- mydata2$CMA</span><br></pre></td></tr></table></figure>
<p>The, we calculate Excess Returns for Target fund</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">lo_30.xcess &lt;- mydata2$Lo.30 - rf</span><br></pre></td></tr></table></figure>
<h2 id="Run-Fama-French-Regression"><a href="#Run-Fama-French-Regression" class="headerlink" title="Run Fama-French Regression"></a>Run Fama-French Regression</h2><p>Plot of data:</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#=========================</span></span><br><span class="line"><span class="comment">### Boxplots</span></span><br><span class="line"><span class="keyword">library</span>(lattice)</span><br><span class="line">bwplot(~lo_30.xcess, xlab = <span class="string">&quot;Portfolio excess return&quot;</span>) <span class="comment"># Both side outliers</span></span><br></pre></td></tr></table></figure>
<p><img src="/images/MC_FF5_files/figure-markdown_github/unnamed-chunk-4-1.png" alt=""></p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bwplot(~rmrf, xlab = expression(K[m] - R[f]))</span><br></pre></td></tr></table></figure>
<p><img src="/images/MC_FF5_files/figure-markdown_github/unnamed-chunk-4-2.png" alt=""></p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bwplot(~smb, xlab = <span class="string">&quot;SMB&quot;</span>)</span><br></pre></td></tr></table></figure>
<p><img src="/images/MC_FF5_files/figure-markdown_github/unnamed-chunk-4-3.png" alt=""></p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bwplot(~hml, xlab = <span class="string">&quot;HML&quot;</span>)</span><br></pre></td></tr></table></figure>
<p><img src="/images/MC_FF5_files/figure-markdown_github/unnamed-chunk-4-4.png" alt=""></p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bwplot(~rmw, xlab = <span class="string">&quot;RMW&quot;</span>)</span><br></pre></td></tr></table></figure>
<p><img src="/images/MC_FF5_files/figure-markdown_github/unnamed-chunk-4-5.png" alt=""></p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bwplot(~cma, xlab = <span class="string">&quot;CMA&quot;</span>)</span><br></pre></td></tr></table></figure>
<p><img src="/images/MC_FF5_files/figure-markdown_github/unnamed-chunk-4-6.png" alt=""></p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># density plot</span></span><br><span class="line">densityplot(lo_30.xcess, xlab = <span class="string">&quot;Portfolio excess return&quot;</span>)</span><br></pre></td></tr></table></figure>
<p><img src="/images/MC_FF5_files/figure-markdown_github/unnamed-chunk-4-7.png" alt=""></p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">library</span>(car)     <span class="comment"># red line affected by outlier, green ignoring the outlier (robust)</span></span><br><span class="line">scatterplot(x = lo_30.xcess, y = rmrf)       <span class="comment">#(dependent)</span></span><br></pre></td></tr></table></figure>
<p><img src="/images/MC_FF5_files/figure-markdown_github/unnamed-chunk-4-8.png" alt=""></p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">scatterplot(x = lo_30.xcess, y = smb)       <span class="comment">#(dependent)</span></span><br></pre></td></tr></table></figure>
<p><img src="/images/MC_FF5_files/figure-markdown_github/unnamed-chunk-4-9.png" alt=""></p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">scatterplot(x = lo_30.xcess, y = hml)       <span class="comment">#(dependent)</span></span><br></pre></td></tr></table></figure>
<p><img src="/images/MC_FF5_files/figure-markdown_github/unnamed-chunk-4-10.png" alt=""></p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">scatterplot(x = lo_30.xcess, y = rmw)       <span class="comment">#(dependent)</span></span><br></pre></td></tr></table></figure>
<p><img src="/images/MC_FF5_files/figure-markdown_github/unnamed-chunk-4-11.png" alt=""></p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">scatterplot(x = lo_30.xcess, y = cma)       <span class="comment">#(dependent)</span></span><br></pre></td></tr></table></figure>
<p><img src="/images/MC_FF5_files/figure-markdown_github/unnamed-chunk-4-12.png" alt=""></p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">library</span>(ggplot2)</span><br><span class="line"><span class="comment"># scatterplot using ggplot</span></span><br><span class="line">ggplot(mapping = aes(x = rmrf, y = lo_30.xcess)) + </span><br><span class="line">  geom_point(colour = <span class="string">&apos;skyblue&apos;</span>) + </span><br><span class="line">  geom_smooth(method = <span class="string">&apos;lm&apos;</span>)</span><br></pre></td></tr></table></figure>
<p><img src="/images/MC_FF5_files/figure-markdown_github/unnamed-chunk-4-13.png" alt=""></p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ggplot(mapping = aes(x = smb, y = lo_30.xcess)) + </span><br><span class="line">  geom_point(colour = <span class="string">&apos;skyblue&apos;</span>) + </span><br><span class="line">  geom_smooth(method = <span class="string">&apos;lm&apos;</span>)</span><br></pre></td></tr></table></figure>
<p><img src="/images/MC_FF5_files/figure-markdown_github/unnamed-chunk-4-14.png" alt=""></p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ggplot(mapping = aes(x = hml, y = lo_30.xcess)) + </span><br><span class="line">  geom_point(colour = <span class="string">&apos;skyblue&apos;</span>) + </span><br><span class="line">  geom_smooth(method = <span class="string">&apos;lm&apos;</span>)</span><br></pre></td></tr></table></figure>
<p><img src="/images/MC_FF5_files/figure-markdown_github/unnamed-chunk-4-15.png" alt=""></p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ggplot(mapping = aes(x = rmw, y = lo_30.xcess)) + </span><br><span class="line">  geom_point(colour = <span class="string">&apos;skyblue&apos;</span>) + </span><br><span class="line">  geom_smooth(method = <span class="string">&apos;lm&apos;</span>)</span><br></pre></td></tr></table></figure>
<p><img src="/images/MC_FF5_files/figure-markdown_github/unnamed-chunk-4-16.png" alt=""></p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ggplot(mapping = aes(x = cma, y = lo_30.xcess)) + </span><br><span class="line">  geom_point(colour = <span class="string">&apos;skyblue&apos;</span>) + </span><br><span class="line">  geom_smooth(method = <span class="string">&apos;lm&apos;</span>)</span><br></pre></td></tr></table></figure>
<p><img src="/images/MC_FF5_files/figure-markdown_github/unnamed-chunk-4-17.png" alt=""></p>
<p>We can run the linear regression to get the <em>&#x3B2;</em>.</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">lo_30.ffregression &lt;- lm(lo_30.xcess ~ </span><br><span class="line">                           rmrf + smb + hml + rmw + cma)</span><br><span class="line"><span class="comment"># Print summary of regression results</span></span><br><span class="line">lo_30.sum &lt;- summary(lo_30.ffregression)</span><br><span class="line">lo_30.sum</span><br></pre></td></tr></table></figure>
<pre><code>## 
## Call:
## lm(formula = lo_30.xcess ~ rmrf + smb + hml + rmw + cma)
## 
## Residuals:
##      Min       1Q   Median       3Q      Max 
## -0.59616 -0.05422 -0.00001  0.05556  0.52712 
## 
## Coefficients:
##              Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)  0.004495   0.001949   2.306   0.0212 *  
## rmrf         0.979197   0.001806 542.072  &lt; 2e-16 ***
## smb         -0.029402   0.003511  -8.374  &lt; 2e-16 ***
## hml         -0.258457   0.003373 -76.618  &lt; 2e-16 ***
## rmw          0.055243   0.006215   8.889  &lt; 2e-16 ***
## cma         -0.034451   0.006684  -5.154 2.74e-07 ***
## ---
## Signif. codes:  0 &apos;***&apos; 0.001 &apos;**&apos; 0.01 &apos;*&apos; 0.05 &apos;.&apos; 0.1 &apos; &apos; 1
## 
## Residual standard error: 0.09759 on 2512 degrees of freedom
## Multiple R-squared:  0.9933, Adjusted R-squared:  0.9933 
## F-statistic: 7.486e+04 on 5 and 2512 DF,  p-value: &lt; 2.2e-16
</code></pre><p>Plot of regression:</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">par(mfrow=c(<span class="number">2</span>,<span class="number">2</span>))</span><br><span class="line">plot(lo_30.ffregression)</span><br></pre></td></tr></table></figure>
<p><img src="/images/MC_FF5_files/figure-markdown_github/unnamed-chunk-6-1.png" alt=""></p>
<h1 id="Monte-Carlo-Simulation"><a href="#Monte-Carlo-Simulation" class="headerlink" title="Monte Carlo Simulation"></a>Monte Carlo Simulation</h1><p>Next, we are running Monte Carlo Simulation for Fama French 5 Factor Model.</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#===========================================</span></span><br><span class="line"><span class="comment">## Construct X data frame</span></span><br><span class="line"><span class="comment"># X data: rmrf, smb, hml, rmw, cma</span></span><br><span class="line">X &lt;- data.matrix(cbind(rep(<span class="number">1</span>, dim(mydata2)[<span class="number">1</span>]), </span><br><span class="line">                       rmrf, smb, hml, rmw, cma))</span><br><span class="line">is.matrix(X)</span><br></pre></td></tr></table></figure>
<pre><code>## [1] TRUE
</code></pre><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dim(X)</span><br></pre></td></tr></table></figure>
<pre><code>## [1] 2518    6
</code></pre><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># # obervations</span></span><br><span class="line">M &lt;- dim(X)[<span class="number">1</span>]</span><br><span class="line"><span class="comment"># True beta</span></span><br><span class="line">beta &lt;- lo_30.sum$coefficients[,<span class="number">1</span>]</span><br><span class="line">is.vector(beta)</span><br></pre></td></tr></table></figure>
<pre><code>## [1] TRUE
</code></pre><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">class(beta)</span><br></pre></td></tr></table></figure>
<pre><code>## [1] &quot;numeric&quot;
</code></pre><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">length(beta)</span><br></pre></td></tr></table></figure>
<pre><code>## [1] 6
</code></pre><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#</span></span><br><span class="line">mu &lt;- <span class="number">0</span></span><br><span class="line">sig2e &lt;- var(lo_30.xcess)</span><br><span class="line"><span class="comment"># True sigma: std of distribution of error term</span></span><br><span class="line">sde &lt;- sqrt(sig2e)</span><br><span class="line">sde</span><br></pre></td></tr></table></figure>
<pre><code>## [1] 1.194133
</code></pre><h2 id="One-example-of-Monte-Carlo-Simulation"><a href="#One-example-of-Monte-Carlo-Simulation" class="headerlink" title="One example of Monte Carlo Simulation"></a>One example of Monte Carlo Simulation</h2><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">set.seed(<span class="number">12345</span>)</span><br><span class="line">Y &lt;- X %*% beta + rnorm(M, mean=<span class="number">0</span>, sd=sde)</span><br><span class="line">class(Y)</span><br></pre></td></tr></table></figure>
<pre><code>## [1] &quot;matrix&quot;
</code></pre><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">is.vector(Y)</span><br></pre></td></tr></table></figure>
<pre><code>## [1] FALSE
</code></pre><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">is.matrix(Y)</span><br></pre></td></tr></table></figure>
<pre><code>## [1] TRUE
</code></pre><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">length(Y)</span><br></pre></td></tr></table></figure>
<pre><code>## [1] 2518
</code></pre><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ff&lt;-lm(Y~X[,-<span class="number">1</span>])</span><br><span class="line"></span><br><span class="line">sum &lt;- summary(ff)</span><br><span class="line">sum</span><br></pre></td></tr></table></figure>
<pre><code>## 
## Call:
## lm(formula = Y ~ X[, -1])
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -3.9939 -0.7897  0.0157  0.8026  3.9580 
## 
## Coefficients:
##              Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept) -0.002067   0.023685  -0.087    0.930    
## X[, -1]rmrf  0.980129   0.021947  44.659  &lt; 2e-16 ***
## X[, -1]smb  -0.067441   0.042660  -1.581    0.114    
## X[, -1]hml  -0.308533   0.040985  -7.528 7.14e-14 ***
## X[, -1]rmw  -0.056562   0.075507  -0.749    0.454    
## X[, -1]cma  -0.023310   0.081204  -0.287    0.774    
## ---
## Signif. codes:  0 &apos;***&apos; 0.001 &apos;**&apos; 0.01 &apos;*&apos; 0.05 &apos;.&apos; 0.1 &apos; &apos; 1
## 
## Residual standard error: 1.186 on 2512 degrees of freedom
## Multiple R-squared:  0.503,  Adjusted R-squared:  0.502 
## F-statistic: 508.5 on 5 and 2512 DF,  p-value: &lt; 2.2e-16
</code></pre><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#==============================</span></span><br><span class="line"><span class="comment"># Confidence interval</span></span><br><span class="line">cfi&lt;-confint(ff)</span><br><span class="line">cfi</span><br></pre></td></tr></table></figure>
<pre><code>##                   2.5 %      97.5 %
## (Intercept) -0.04851118  0.04437665
## X[, -1]rmrf  0.93709258  1.02316506
## X[, -1]smb  -0.15109374  0.01621131
## X[, -1]hml  -0.38890087 -0.22816575
## X[, -1]rmw  -0.20462411  0.09150049
## X[, -1]cma  -0.18254382  0.13592330
</code></pre><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">class(cfi)</span><br></pre></td></tr></table></figure>
<pre><code>## [1] &quot;matrix&quot;
</code></pre><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dim(cfi)</span><br></pre></td></tr></table></figure>
<pre><code>## [1] 6 2
</code></pre><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># If true beta is in confidence interval of estimated beta</span></span><br><span class="line">flag.beta &lt;- logical(length(beta))</span><br><span class="line"><span class="keyword">for</span> (k <span class="keyword">in</span> <span class="number">1</span>:length(beta)){</span><br><span class="line">flag.beta[k] &lt;- cfi[k,<span class="number">1</span>]&lt;=beta[k]&amp;&amp;cfi[k,<span class="number">2</span>]&gt;=beta[k]</span><br><span class="line">}</span><br><span class="line">flag.beta</span><br></pre></td></tr></table></figure>
<pre><code>## [1] TRUE TRUE TRUE TRUE TRUE TRUE
</code></pre><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">class(flag.beta)</span><br></pre></td></tr></table></figure>
<pre><code>## [1] &quot;logical&quot;
</code></pre><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">length(flag.beta)</span><br></pre></td></tr></table></figure>
<pre><code>## [1] 6
</code></pre><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#==============================</span></span><br><span class="line"><span class="comment"># estimated error variance</span></span><br><span class="line">err.var &lt;- deviance(ff)/df.residual(ff)</span><br><span class="line">err.var</span><br></pre></td></tr></table></figure>
<pre><code>## [1] 1.405962
</code></pre><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#==============================</span></span><br><span class="line"><span class="comment"># \hat{\beta}</span></span><br><span class="line">ff$coefficients</span><br></pre></td></tr></table></figure>
<pre><code>##  (Intercept)  X[, -1]rmrf   X[, -1]smb   X[, -1]hml   X[, -1]rmw 
## -0.002067263  0.980128819 -0.067441217 -0.308533310 -0.056561812 
##   X[, -1]cma 
## -0.023310260
</code></pre><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#==============================</span></span><br><span class="line"><span class="comment"># T-Test: Null Hypothesis: betahat = beta</span></span><br><span class="line"><span class="comment"># Significant level of t-test</span></span><br><span class="line">alp &lt;- <span class="number">0.05</span></span><br><span class="line"><span class="comment"># T statistics = (betahat-beta)/s.e.</span></span><br><span class="line">t.stat &lt;- (sum$coefficients[,<span class="number">1</span>]-beta)/sum$coefficients[,<span class="number">2</span>]</span><br><span class="line"><span class="comment"># t_{1-\alpha/2, n-k}</span></span><br><span class="line">thr &lt;- qt(<span class="number">1</span>-alp/<span class="number">2</span>, df = df.residual(ff))</span><br><span class="line"><span class="comment"># whether reject null hypothesis: False - not reject; True - reject (Type I)</span></span><br><span class="line"><span class="comment"># We should not reject the null hypothesis of beta = betahat</span></span><br><span class="line"><span class="comment"># But if we reject it (&lt;alp), we are making Type I error, right?</span></span><br><span class="line">flag.type1 &lt;- t.stat&gt;thr | t.stat &lt; - thr</span><br><span class="line">flag.type1</span><br></pre></td></tr></table></figure>
<pre><code>## (Intercept) X[, -1]rmrf  X[, -1]smb  X[, -1]hml  X[, -1]rmw  X[, -1]cma 
##       FALSE       FALSE       FALSE       FALSE       FALSE       FALSE
</code></pre><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">class(flag.type1)</span><br></pre></td></tr></table></figure>
<pre><code>## [1] &quot;logical&quot;
</code></pre><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">length(flag.type1)</span><br></pre></td></tr></table></figure>
<pre><code>## [1] 6
</code></pre><h2 id="Running-Monte-Carlo-Simulation"><a href="#Running-Monte-Carlo-Simulation" class="headerlink" title="Running Monte Carlo Simulation"></a>Running Monte Carlo Simulation</h2><p>Run the Monte Carlo Simulation as follow.</p>
<p><strong>Note</strong>:</p>
<ul>
<li>this is just a demo with replication number N = 100.</li>
<li>Actually, we run the Monte Carlo Simulation with replication number N = 10<sup>5</sup></li>
<li>We will save the data in a file named <code>mcff5_2008_2018.RData</code>.</li>
</ul>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># level of t-test</span></span><br><span class="line">alpha &lt;- <span class="number">0.05</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line">temp &lt;- <span class="number">1</span>:length(beta)</span><br><span class="line">nbv &lt;- temp[-<span class="number">2</span>]</span><br><span class="line"><span class="comment"># Number of Replication</span></span><br><span class="line">N &lt;- <span class="number">100</span></span><br><span class="line">mat.beta &lt;- matrix(<span class="number">0</span>,nrow = N, ncol = length(beta))</span><br><span class="line">mat.beta2 &lt;- matrix(<span class="number">0</span>,nrow = N, ncol = length(beta)-<span class="number">1</span>)</span><br><span class="line">vec.flag.beta &lt;- logical(N*length(beta))</span><br><span class="line">vec.err.var &lt;- numeric(N)</span><br><span class="line">vec.err.var2 &lt;- numeric(N)</span><br><span class="line">vec.flag.type1 &lt;- logical(N*length(beta))</span><br><span class="line">vec.flag.type1.2 &lt;- logical(N*(length(beta)-<span class="number">1</span>))</span><br><span class="line">mat.t.stat &lt;- matrix(<span class="number">0</span>,nrow = N, ncol = length(beta))</span><br><span class="line">mat.t.stat2 &lt;- matrix(<span class="number">0</span>,nrow = N, ncol = length(beta)-<span class="number">1</span>)</span><br><span class="line"><span class="comment"># </span></span><br><span class="line"><span class="keyword">for</span> (i <span class="keyword">in</span> <span class="number">1</span>:N) {</span><br><span class="line">  set.seed(<span class="number">27</span>+<span class="number">6</span>*i)</span><br><span class="line">  Y &lt;- X %*% beta + rnorm(M, mean=<span class="number">0</span>, sd=sde)</span><br><span class="line">  <span class="comment"># Full Linear Regression</span></span><br><span class="line">  ff&lt;-lm(Y~X[,-<span class="number">1</span>])</span><br><span class="line">  <span class="comment"># Omitt rmrf variable</span></span><br><span class="line">  ff2&lt;-lm(Y~X[,c(-<span class="number">1</span>,-<span class="number">2</span>)])</span><br><span class="line">  <span class="comment"># Confidence interval</span></span><br><span class="line">  cfi&lt;-confint(ff)</span><br><span class="line">  <span class="comment"># If true: beta is in confidence interval of estimated beta</span></span><br><span class="line">  <span class="keyword">for</span> (k <span class="keyword">in</span> <span class="number">1</span>:length(beta)){</span><br><span class="line">    vec.flag.beta[(i-<span class="number">1</span>)*length(beta)+k] &lt;- </span><br><span class="line">      cfi[k,<span class="number">1</span>]&lt;=beta[k]&amp;&amp;cfi[k,<span class="number">2</span>]&gt;=beta[k]</span><br><span class="line">  }</span><br><span class="line">  <span class="comment"># estimated error variance</span></span><br><span class="line">  vec.err.var[i] &lt;- deviance(ff)/df.residual(ff)</span><br><span class="line">  vec.err.var2[i] &lt;- deviance(ff2)/df.residual(ff2)</span><br><span class="line">  <span class="comment"># \hat{\beta}</span></span><br><span class="line">  mat.beta[i,] &lt;- as.matrix(ff$coefficients)</span><br><span class="line">  mat.beta2[i,] &lt;- as.matrix(ff2$coefficients)</span><br><span class="line">  <span class="comment"># T statistics = (betahat-beta)/s.e.</span></span><br><span class="line">  sum &lt;- summary(ff)</span><br><span class="line">  sum2 &lt;- summary(ff2)</span><br><span class="line">  mat.t.stat[i,] &lt;- (sum$coefficients[,<span class="number">1</span>]-beta)/</span><br><span class="line">    sum$coefficients[,<span class="number">2</span>]</span><br><span class="line">  mat.t.stat2[i,] &lt;- (sum2$coefficients[,<span class="number">1</span>]-beta[nbv])/</span><br><span class="line">    sum2$coefficients[,<span class="number">2</span>]</span><br><span class="line">  <span class="comment"># t_{1-\alpha/2, n-k}</span></span><br><span class="line">  threshold &lt;- qt(<span class="number">1</span>-alpha/<span class="number">2</span>, df = df.residual(ff))</span><br><span class="line">  <span class="comment"># whether reject null hypothesis: False - not reject; True - reject (Type I)</span></span><br><span class="line">  <span class="comment"># We should not reject the null hypothesis of beta = betahat</span></span><br><span class="line">  <span class="comment"># But if we reject it (&lt;alp), we are making Type I error, right?</span></span><br><span class="line">  <span class="keyword">for</span> (k <span class="keyword">in</span> <span class="number">1</span>:length(beta)){</span><br><span class="line">    vec.flag.type1[(i-<span class="number">1</span>)*length(beta)+k] &lt;-</span><br><span class="line">      mat.t.stat[i,k] &gt; threshold | </span><br><span class="line">      mat.t.stat[i,k] &lt; -threshold</span><br><span class="line">  }</span><br><span class="line">  <span class="keyword">for</span> (k <span class="keyword">in</span> <span class="number">1</span>:(length(beta)-<span class="number">1</span>)){</span><br><span class="line">    vec.flag.type1.2[(i-<span class="number">1</span>)*(length(beta)-<span class="number">1</span>)+k] &lt;- </span><br><span class="line">      mat.t.stat2[i,k] &gt; threshold | </span><br><span class="line">      mat.t.stat2[i,k] &lt; -threshold</span><br><span class="line">  }</span><br><span class="line">}</span><br><span class="line">mat.flag.beta &lt;- matrix(vec.flag.beta, </span><br><span class="line">                        ncol = length(beta), </span><br><span class="line">                        byrow = <span class="literal">T</span>)</span><br><span class="line">mat.flag.type1 &lt;- matrix(vec.flag.type1, </span><br><span class="line">                         ncol = length(beta), </span><br><span class="line">                         byrow = <span class="literal">T</span>)</span><br><span class="line">mat.flag.type1.2 &lt;- matrix(vec.flag.type1.2, </span><br><span class="line">                           ncol = length(beta)-<span class="number">1</span>, </span><br><span class="line">                           byrow = <span class="literal">T</span>)</span><br></pre></td></tr></table></figure>
<h2 id="Plot"><a href="#Plot" class="headerlink" title="Plot"></a>Plot</h2><p>Load the completed Monte Carlo data from file and set the parameters.</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">rm(list=ls())</span><br><span class="line"><span class="comment">#graphics.off()</span></span><br><span class="line"><span class="comment">#=======================================================================================#</span></span><br><span class="line"><span class="comment"># load data</span></span><br><span class="line">load(file=<span class="string">&quot;5factors_2008_2018.RData&quot;</span>)</span><br><span class="line"><span class="comment"># Extract Fama-French Factors and Fund Returns</span></span><br><span class="line">mydate &lt;- mydata2$Date</span><br><span class="line">range(mydate)</span><br></pre></td></tr></table></figure>
<pre><code>## [1] &quot;2008-01-02&quot; &quot;2017-12-29&quot;
</code></pre><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line">rmrf &lt;- mydata2$Mkt.RF</span><br><span class="line">smb &lt;- mydata2$SMB</span><br><span class="line">hml &lt;- mydata2$HML</span><br><span class="line">rf &lt;- mydata2$RF</span><br><span class="line">rmw &lt;- mydata2$RMW</span><br><span class="line">cma &lt;- mydata2$CMA</span><br><span class="line"></span><br><span class="line"><span class="comment"># Calculate Excess Returns for Target fund</span></span><br><span class="line">lo_30.xcess &lt;- mydata2$Lo.30 - rf</span><br><span class="line"><span class="comment">#==================================================</span></span><br><span class="line"><span class="comment"># Run Fama-French Regression</span></span><br><span class="line">lo_30.ffregression &lt;- lm(lo_30.xcess ~ </span><br><span class="line">                           rmrf + smb + hml + rmw + cma)</span><br><span class="line"><span class="comment"># Print summary of regression results</span></span><br><span class="line">lo_30.sum &lt;- summary(lo_30.ffregression)</span><br><span class="line"><span class="comment">#===========================================</span></span><br><span class="line"><span class="comment">## Construct X data frame</span></span><br><span class="line"><span class="comment"># X data: rmrf, smb, hml, rmw, cma</span></span><br><span class="line">X &lt;- data.matrix(cbind(rep(<span class="number">1</span>, dim(mydata2)[<span class="number">1</span>]), </span><br><span class="line">                       rmrf, smb, hml, rmw, cma))</span><br><span class="line"><span class="comment"># Coloum Summary</span></span><br><span class="line">summaryfun &lt;- <span class="keyword">function</span>(x){</span><br><span class="line">  nr = dim(x)[<span class="number">2</span>]</span><br><span class="line">  nc = <span class="number">6</span></span><br><span class="line">  temp &lt;- rep(<span class="literal">NA</span>, nr*nc)</span><br><span class="line">  out &lt;- matrix(temp, nrow = nr, ncol = nc) </span><br><span class="line">  <span class="keyword">for</span> (i <span class="keyword">in</span> <span class="number">1</span>:dim(X)[<span class="number">2</span>]){</span><br><span class="line">    out[i,] &lt;- c(N = length(x[,i]),</span><br><span class="line">                 Mean = mean(x[,i]),</span><br><span class="line">                 Median = median(x[,i]),</span><br><span class="line">                 StdDev = sd(x[,i]),</span><br><span class="line">                 Min = min(x[,i]),</span><br><span class="line">                 Max = max(x[,i]))</span><br><span class="line">  }</span><br><span class="line">  out1 &lt;- as.data.frame(out)</span><br><span class="line">  <span class="keyword">return</span>(out1)</span><br><span class="line">}</span><br><span class="line">des.stat &lt;- summaryfun(X)</span><br><span class="line">names(des.stat) &lt;- c(<span class="string">&quot;N&quot;</span>,</span><br><span class="line">                     <span class="string">&quot;Mean&quot;</span>, </span><br><span class="line">                     <span class="string">&quot;Median&quot;</span>,</span><br><span class="line">                     <span class="string">&quot;St.Dev&quot;</span>,</span><br><span class="line">                     <span class="string">&quot;Min&quot;</span>,</span><br><span class="line">                     <span class="string">&quot;Max&quot;</span>)</span><br><span class="line">row.names(des.stat) &lt;- c(<span class="string">&quot;1&quot;</span>,</span><br><span class="line">                             <span class="string">&quot;RmRf&quot;</span>, </span><br><span class="line">                             <span class="string">&quot;SMB&quot;</span>,</span><br><span class="line">                             <span class="string">&quot;HML&quot;</span>,</span><br><span class="line">                             <span class="string">&quot;RMW&quot;</span>,</span><br><span class="line">                             <span class="string">&quot;CMA&quot;</span>)</span><br><span class="line"><span class="comment"># stargazer</span></span><br><span class="line"><span class="comment">#install.packages(&quot;stargazer&quot;) #Use this to install it, do this only once</span></span><br><span class="line"><span class="keyword">library</span>(stargazer)</span><br></pre></td></tr></table></figure>
<pre><code>## 
## Please cite as:

##  Hlavac, Marek (2018). stargazer: Well-Formatted Regression and Summary Statistics Tables.

##  R package version 5.2.1. https://CRAN.R-project.org/package=stargazer
</code></pre><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">stargazer(as.data.frame(X), type = <span class="string">&quot;text&quot;</span>, title=<span class="string">&quot;Descriptive statistics&quot;</span>, digits=<span class="number">4</span>, out=<span class="string">&quot;output_star_X.txt&quot;</span>)</span><br></pre></td></tr></table></figure>
<pre><code>## 
## Descriptive statistics
## ===============================================
## Statistic   N    Mean  St. Dev.   Min     Max  
## -----------------------------------------------
## V1        2,518 1.0000  0.0000     1       1   
## rmrf      2,518 0.0410  1.2911  -8.9500 11.3500
## smb       2,518 0.0080  0.5957  -3.4100 4.4800 
## hml       2,518 0.0002  0.7224  -4.2200 4.8300 
## rmw       2,518 0.0139  0.3843  -2.6000 1.9400 
## cma       2,518 0.0030  0.3146  -1.7000 1.9700 
## -----------------------------------------------
</code></pre><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># # obervations</span></span><br><span class="line">M &lt;- dim(X)[<span class="number">1</span>]</span><br><span class="line"><span class="comment"># True beta</span></span><br><span class="line">beta &lt;- lo_30.sum$coefficients[,<span class="number">1</span>]</span><br><span class="line"><span class="comment">#</span></span><br><span class="line">mu &lt;- <span class="number">0</span></span><br><span class="line">sig2e &lt;- var(lo_30.xcess)</span><br><span class="line"><span class="comment"># True sigma: std of distribution of error term</span></span><br><span class="line">sde &lt;- sqrt(sig2e)</span><br></pre></td></tr></table></figure>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#==================================</span></span><br><span class="line"><span class="comment"># Load runned data</span></span><br><span class="line">load(file = <span class="string">&quot;mcff5_2008_2018_mutiplemodel_20180403.RData&quot;</span>)</span><br><span class="line"><span class="keyword">attach</span>(object)</span><br><span class="line">dim(object)</span><br></pre></td></tr></table></figure>
<pre><code>## NULL
</code></pre><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#===========================</span></span><br><span class="line"><span class="comment"># Significance level of t-test</span></span><br><span class="line">alpha &lt;- <span class="number">0.05</span></span><br><span class="line"><span class="comment"># Ordinal number for second model with omitted variable</span></span><br><span class="line">temp &lt;- <span class="number">1</span>:length(beta)</span><br><span class="line">nbv2 &lt;- temp[-<span class="number">2</span>]</span><br><span class="line">nbv3 &lt;- temp[-<span class="number">3</span>]</span><br><span class="line">nbv4 &lt;- temp[-<span class="number">4</span>]</span><br><span class="line">nbv5 &lt;- temp[-<span class="number">5</span>]</span><br><span class="line">nbv6 &lt;- temp[-<span class="number">6</span>]</span><br><span class="line">nbv7 &lt;- temp[<span class="number">1</span>:<span class="number">4</span>]</span><br><span class="line">nbv8 &lt;- temp[<span class="number">1</span>:<span class="number">2</span>]</span><br><span class="line"><span class="comment">#=======================</span></span><br><span class="line"><span class="comment">#vecN = c(10,50,100)</span></span><br><span class="line">vecN = c(<span class="number">10</span>,<span class="number">50</span>,<span class="number">100</span>,<span class="number">500</span>,<span class="number">1e3</span>,<span class="number">5e3</span>,seq(from = <span class="number">1e4</span>, to = <span class="number">1e5</span>, by = <span class="number">1e4</span>))</span><br><span class="line">mat.betahat &lt;- matrix(<span class="number">0</span>, </span><br><span class="line">                      nrow = length(vecN), </span><br><span class="line">                      ncol = length(beta))</span><br><span class="line">mat.betahat2 &lt;- matrix(<span class="number">0</span>, </span><br><span class="line">                       nrow = length(vecN), </span><br><span class="line">                       ncol = length(nbv2))</span><br><span class="line"></span><br><span class="line">mat.vebh &lt;- matrix(<span class="number">0</span>, </span><br><span class="line">                   nrow = length(vecN), </span><br><span class="line">                   ncol = length(beta))</span><br><span class="line">vec.err.varh &lt;- numeric(length(vecN))</span><br><span class="line">vec.prob.err.varh &lt;- numeric(length(vecN))</span><br><span class="line">vec.err.varh2 &lt;- numeric(length(vecN))</span><br><span class="line">vec.prob.err.varh2 &lt;- numeric(length(vecN))</span><br><span class="line">prob.flag.beta &lt;- matrix(<span class="number">0</span>, </span><br><span class="line">                         nrow = length(vecN), </span><br><span class="line">                         ncol = length(beta))</span><br><span class="line">prob.flag.type1 &lt;- matrix(<span class="number">0</span>, </span><br><span class="line">                          nrow = length(vecN), </span><br><span class="line">                          ncol = length(beta))</span><br><span class="line">prob.flag.type1.2 &lt;- matrix(<span class="number">0</span>, </span><br><span class="line">                            nrow = length(vecN), </span><br><span class="line">                            ncol = length(beta)-<span class="number">1</span>)</span><br><span class="line">mat.t.stathat &lt;- matrix(<span class="number">0</span>, </span><br><span class="line">                        nrow = length(vecN), </span><br><span class="line">                        ncol = length(beta))</span><br><span class="line"><span class="keyword">for</span> (j <span class="keyword">in</span> <span class="number">1</span>:length(vecN)){</span><br><span class="line">  N &lt;- vecN[j]</span><br><span class="line">  <span class="comment"># tolerance</span></span><br><span class="line">  epsilon &lt;- <span class="number">0.05</span></span><br><span class="line">  <span class="comment"># \hat{\beta}</span></span><br><span class="line">  mat.betahat[j,] &lt;- colMeans(mat.beta[<span class="number">1</span>:N,])</span><br><span class="line">  <span class="comment">#</span></span><br><span class="line">  mat.betahat2[j,] &lt;- colMeans(mat.beta2[<span class="number">1</span>:N,])</span><br><span class="line">  <span class="comment"># \variance of betahat</span></span><br><span class="line">  mat.vebh[j,] &lt;- apply(mat.beta[<span class="number">1</span>:N,], <span class="number">2</span>, var)</span><br><span class="line">  <span class="comment"># error variance</span></span><br><span class="line">  vec.err.varh[j] &lt;- mean(vec.err.var[<span class="number">1</span>:N])</span><br><span class="line">  <span class="comment"># P(abs(err.varh - sig2e) &gt;= epsilon)</span></span><br><span class="line">  vec.prob.err.varh[j] &lt;- sum(abs(vec.err.var[<span class="number">1</span>:N] - sig2e) </span><br><span class="line">                              &gt;= epsilon)/N</span><br><span class="line">  <span class="comment"># error variance for model 2</span></span><br><span class="line">  vec.err.varh2[j] &lt;- mean(vec.err.var2[<span class="number">1</span>:N])</span><br><span class="line">  <span class="comment"># P(abs(err.varh - sig2e) &gt;= epsilon)</span></span><br><span class="line">  vec.prob.err.varh2[j] &lt;- sum(abs(vec.err.var2[<span class="number">1</span>:N] - sig2e) </span><br><span class="line">                               &gt;= epsilon)/N</span><br><span class="line">  <span class="comment"># Probability of true beta is in confidence interval of estimated beta</span></span><br><span class="line">  prob.flag.beta[j,] &lt;- colSums(mat.flag.beta[<span class="number">1</span>:N,])/N</span><br><span class="line">  <span class="comment"># Prob of Type I</span></span><br><span class="line">  prob.flag.type1[j,] &lt;- colSums(mat.flag.type1[<span class="number">1</span>:N,])/N</span><br><span class="line">  <span class="comment"># Prob of Type I</span></span><br><span class="line">  prob.flag.type1.2[j,] &lt;- colSums(mat.flag.type1.2[<span class="number">1</span>:N,])/N</span><br><span class="line">  <span class="comment"># </span></span><br><span class="line">  mat.t.stathat[j,] &lt;- colMeans(mat.t.stat[<span class="number">1</span>:N,])</span><br><span class="line">}</span><br><span class="line"><span class="comment">#==============================================</span></span><br><span class="line"><span class="comment"># Model Selection Table</span></span><br><span class="line">v.rsq.adj &lt;- c(mean(rsq.adj),mean(rsq.adj2),mean(rsq.adj3),mean(rsq.adj4),</span><br><span class="line">           mean(rsq.adj5),mean(rsq.adj6),mean(rsq.adj7),mean(rsq.adj8))</span><br><span class="line">v.aic &lt;- c(mean(aic),mean(aic2),mean(aic3),mean(aic4),</span><br><span class="line">           mean(aic5),mean(aic6),mean(aic7),mean(aic8))</span><br><span class="line">v.bic &lt;- c(mean(bic),mean(bic2),mean(bic3),mean(bic4),</span><br><span class="line">           mean(bic5),mean(bic6),mean(bic7),mean(bic8))</span><br><span class="line">v.mlcp &lt;- c(<span class="literal">NaN</span>,mean(mlcp2),mean(mlcp3),mean(mlcp4),</span><br><span class="line">           mean(mlcp5),mean(mlcp6),mean(mlcp7),mean(mlcp8))</span><br><span class="line">model_select &lt;- as.data.frame(cbind(v.rsq.adj,</span><br><span class="line">                              v.aic,</span><br><span class="line">                              v.bic,</span><br><span class="line">                              v.mlcp))</span><br><span class="line">names(model_select) &lt;- c(<span class="string">&quot;Adjusted R-squared&quot;</span>, </span><br><span class="line">                       <span class="string">&quot;AIC&quot;</span>,</span><br><span class="line">                       <span class="string">&quot;BIC&quot;</span>,</span><br><span class="line">                       <span class="string">&quot;Mallow&apos;s Cp&quot;</span>)</span><br><span class="line">row.names(model_select) &lt;- c(<span class="string">&quot;Full Model&quot;</span>,</span><br><span class="line">                             <span class="string">&quot;Model 2&quot;</span>,</span><br><span class="line">                             <span class="string">&quot;Model 3&quot;</span>,</span><br><span class="line">                             <span class="string">&quot;Model 4&quot;</span>,</span><br><span class="line">                             <span class="string">&quot;Model 5&quot;</span>,</span><br><span class="line">                             <span class="string">&quot;Model 6&quot;</span>,</span><br><span class="line">                             <span class="string">&quot;Model 7&quot;</span>,</span><br><span class="line">                             <span class="string">&quot;Model 8&quot;</span>)</span><br><span class="line"><span class="comment">#sink(&quot;output_model_select.txt&quot;)</span></span><br><span class="line">print(model_select)</span><br></pre></td></tr></table></figure>
<pre><code>##            Adjusted R-squared      AIC      BIC  Mallow&apos;s Cp
## Full Model          0.4982286 8046.163 8086.981          NaN
## Model 2             0.1064741 9498.768 9533.756 1963.3724737
## Model 3             0.4981351 8045.635 8080.622   -0.5302520
## Model 4             0.4903992 8084.166 8119.153   38.2578132
## Model 5             0.4981208 8045.706 8080.694   -0.4588785
## Model 6             0.1064741 8045.325 8080.312   -0.8401955
## Model 7             0.4980998 8044.814 8073.970    0.6473720
## Model 8             0.4863740 8100.990 8118.484   61.5142284
</code></pre><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#sink()</span></span><br><span class="line"><span class="comment">#==============================================</span></span><br><span class="line"><span class="comment"># Table of Probability of Type I error for different model</span></span><br><span class="line">temp &lt;- rep(<span class="literal">NA</span>, <span class="number">8</span>*length(beta))</span><br><span class="line">prob.type1 &lt;- matrix(temp,nrow = <span class="number">8</span>, ncol = length(beta)) </span><br><span class="line">prob.type1[<span class="number">1</span>,]&lt;- colSums(mat.flag.type1)/tail(toN,<span class="number">1</span>)</span><br><span class="line">prob.type1[<span class="number">2</span>,nbv2] &lt;- colSums(mat.flag.type1.2)/tail(toN,<span class="number">1</span>)</span><br><span class="line">prob.type1[<span class="number">3</span>,nbv3] &lt;- colSums(mat.flag.type1.3)/tail(toN,<span class="number">1</span>)</span><br><span class="line">prob.type1[<span class="number">4</span>,nbv4] &lt;- colSums(mat.flag.type1.4)/tail(toN,<span class="number">1</span>)</span><br><span class="line">prob.type1[<span class="number">5</span>,nbv5] &lt;- colSums(mat.flag.type1.5)/tail(toN,<span class="number">1</span>)</span><br><span class="line">prob.type1[<span class="number">6</span>,nbv6] &lt;- colSums(mat.flag.type1.6)/tail(toN,<span class="number">1</span>)</span><br><span class="line">prob.type1[<span class="number">7</span>,nbv7] &lt;- colSums(mat.flag.type1.7)/tail(toN,<span class="number">1</span>)</span><br><span class="line">prob.type1[<span class="number">8</span>,nbv8] &lt;- colSums(mat.flag.type1.8)/tail(toN,<span class="number">1</span>)</span><br><span class="line">prob.type1 &lt;- as.data.frame(prob.type1)</span><br><span class="line">names(prob.type1) &lt;- c(<span class="string">&quot;beta1&quot;</span>, </span><br><span class="line">                         <span class="string">&quot;beta2&quot;</span>, </span><br><span class="line">                         <span class="string">&quot;beta3&quot;</span>, </span><br><span class="line">                         <span class="string">&quot;beta4&quot;</span>, </span><br><span class="line">                         <span class="string">&quot;beta5&quot;</span>, </span><br><span class="line">                         <span class="string">&quot;beta6&quot;</span>)</span><br><span class="line">row.names(prob.type1) &lt;- c(<span class="string">&quot;Full Model&quot;</span>,</span><br><span class="line">                             <span class="string">&quot;Model 2&quot;</span>,</span><br><span class="line">                             <span class="string">&quot;Model 3&quot;</span>,</span><br><span class="line">                             <span class="string">&quot;Model 4&quot;</span>,</span><br><span class="line">                             <span class="string">&quot;Model 5&quot;</span>,</span><br><span class="line">                             <span class="string">&quot;Model 6&quot;</span>,</span><br><span class="line">                             <span class="string">&quot;Model 7&quot;</span>,</span><br><span class="line">                             <span class="string">&quot;Model 8&quot;</span>)</span><br><span class="line"><span class="comment">#sink(&quot;output_prob_typeI.txt&quot;)</span></span><br><span class="line">print(prob.type1)</span><br></pre></td></tr></table></figure>
<pre><code>##              beta1   beta2   beta3   beta4   beta5   beta6
## Full Model 0.04988 0.05079 0.04952 0.05018 0.05194 0.04833
## Model 2    0.29885      NA 0.99999 1.00000 1.00000 1.00000
## Model 3    0.04979 0.05161      NA 0.05018 0.05478 0.04849
## Model 4    0.04823 0.59559 0.08615      NA 0.69012 0.64035
## Model 5    0.04969 0.05283 0.05521 0.05892      NA 0.04890
## Model 6    0.04976 0.05202 0.04929 0.05418 0.05192      NA
## Model 7    0.04977 0.05082 0.05601 0.07178      NA      NA
## Model 8    0.04872 0.95811      NA      NA      NA      NA
</code></pre><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#sink()</span></span><br><span class="line"><span class="comment">#==============================================</span></span><br><span class="line"><span class="comment"># Difference between simulated value and true value</span></span><br><span class="line">temp &lt;- rep(<span class="literal">NA</span>, </span><br><span class="line">            <span class="number">8</span>*(length(beta) + <span class="number">1</span>))</span><br><span class="line">tab.bias &lt;- matrix(temp,nrow = <span class="number">8</span>, </span><br><span class="line">                   ncol = length(beta) + <span class="number">1</span>) </span><br><span class="line">tab.bias[<span class="number">1</span>,] &lt;- c(</span><br><span class="line">  <span class="comment"># Bias of OLS estmator of beta</span></span><br><span class="line">  abs(beta-colMeans(mat.beta)),</span><br><span class="line">  <span class="comment"># Bias of OLS estimator of Error Variance</span></span><br><span class="line">  abs(sig2e-mean(vec.err.var)))</span><br><span class="line">tab.bias[<span class="number">2</span>,c(nbv2,<span class="number">7</span>)] &lt;- c(</span><br><span class="line">  <span class="comment"># Bias of OLS estmator of beta</span></span><br><span class="line">  abs(beta[nbv2]-colMeans(mat.beta2)),</span><br><span class="line">  <span class="comment"># Bias of OLS estimator of Error Variance</span></span><br><span class="line">  abs(sig2e-mean(vec.err.var2)))</span><br><span class="line">tab.bias[<span class="number">3</span>,c(nbv3,<span class="number">7</span>)] &lt;- c(</span><br><span class="line">  <span class="comment"># Bias of OLS estmator of beta</span></span><br><span class="line">  abs(beta[nbv3]-colMeans(mat.beta3)),</span><br><span class="line">  <span class="comment"># Bias of OLS estimator of Error Variance</span></span><br><span class="line">  abs(sig2e-mean(vec.err.var3)))</span><br><span class="line">tab.bias[<span class="number">4</span>, c(nbv4,<span class="number">7</span>)] &lt;- c(</span><br><span class="line">  <span class="comment"># Bias of OLS estmator of beta</span></span><br><span class="line">  abs(beta[nbv4]-colMeans(mat.beta4)),</span><br><span class="line">  <span class="comment"># Bias of OLS estimator of Error Variance                    </span></span><br><span class="line">  abs(sig2e-mean(vec.err.var4)))</span><br><span class="line">tab.bias[<span class="number">5</span>, c(nbv5,<span class="number">7</span>)] &lt;- c(</span><br><span class="line">  <span class="comment"># Bias of OLS estmator of beta</span></span><br><span class="line">  abs(beta[nbv5]-colMeans(mat.beta5)),</span><br><span class="line">  <span class="comment"># Bias of OLS estimator of Error Variance                    </span></span><br><span class="line">  abs(sig2e-mean(vec.err.var5)))</span><br><span class="line">tab.bias[<span class="number">6</span>, c(nbv6,<span class="number">7</span>)] &lt;- c(</span><br><span class="line">  <span class="comment"># Bias of OLS estmator of beta</span></span><br><span class="line">  abs(beta[nbv6]-colMeans(mat.beta6)),</span><br><span class="line">  <span class="comment"># Bias of OLS estimator of Error Variance                    </span></span><br><span class="line">  abs(sig2e-mean(vec.err.var6)))</span><br><span class="line">tab.bias[<span class="number">7</span>, c(nbv7,<span class="number">7</span>)] &lt;- c(</span><br><span class="line">  <span class="comment"># Bias of OLS estmator of beta</span></span><br><span class="line">  abs(beta[nbv7]-colMeans(mat.beta7)),</span><br><span class="line">  <span class="comment"># Bias of OLS estimator of Error Variance                    </span></span><br><span class="line">  abs(sig2e-mean(vec.err.var7)))</span><br><span class="line">tab.bias[<span class="number">8</span>, c(nbv8,<span class="number">7</span>)] &lt;- c(</span><br><span class="line">  <span class="comment"># Bias of OLS estmator of beta</span></span><br><span class="line">  abs(beta[nbv8]-colMeans(mat.beta8)),</span><br><span class="line">  <span class="comment"># Bias of OLS estimator of Error Variance                    </span></span><br><span class="line">  abs(sig2e-mean(vec.err.var8)))</span><br><span class="line">tab.bias &lt;- as.data.frame(tab.bias)</span><br><span class="line">names(tab.bias) &lt;- c(<span class="string">&quot;beta1&quot;</span>, </span><br><span class="line">                       <span class="string">&quot;beta2&quot;</span>, </span><br><span class="line">                       <span class="string">&quot;beta3&quot;</span>, </span><br><span class="line">                       <span class="string">&quot;beta4&quot;</span>, </span><br><span class="line">                       <span class="string">&quot;beta5&quot;</span>, </span><br><span class="line">                       <span class="string">&quot;beta6&quot;</span>,</span><br><span class="line">                     <span class="string">&quot;Error Variance&quot;</span>)</span><br><span class="line">row.names(tab.bias) &lt;- c(<span class="string">&quot;Full Model&quot;</span>,</span><br><span class="line">                           <span class="string">&quot;Model 2&quot;</span>,</span><br><span class="line">                           <span class="string">&quot;Model 3&quot;</span>,</span><br><span class="line">                           <span class="string">&quot;Model 4&quot;</span>,</span><br><span class="line">                           <span class="string">&quot;Model 5&quot;</span>,</span><br><span class="line">                           <span class="string">&quot;Model 6&quot;</span>,</span><br><span class="line">                           <span class="string">&quot;Model 7&quot;</span>,</span><br><span class="line">                           <span class="string">&quot;Model 8&quot;</span>)</span><br><span class="line"><span class="comment">#sink(&quot;output_table_bias.txt&quot;)</span></span><br><span class="line">print(tab.bias)</span><br></pre></td></tr></table></figure>
<pre><code>##                   beta1        beta2        beta3        beta4
## Full Model 5.097693e-05 4.548356e-06 0.0001277153 0.0000584728
## Model 2    4.978255e-02           NA 0.3205085589 0.6105273388
## Model 3    3.617108e-04 2.554723e-03           NA 0.0025626935
## Model 4    2.947476e-04 4.621952e-02 0.0247329253           NA
## Model 5    8.998804e-04 3.272899e-03 0.0083072828 0.0110698879
## Model 6    1.948356e-04 2.363134e-03 0.0014945671 0.0061072960
## Model 7    7.339447e-04 1.141030e-03 0.0090608459 0.0156089053
## Model 8    3.142667e-03 6.844190e-02           NA           NA
##                   beta5        beta6 Error Variance
## Full Model 0.0001093913 0.0001619033   4.572658e-05
## Model 2    0.6890978267 0.9219254461   1.113663e+00
## Model 3    0.0136155417 0.0041033581   2.201317e-04
## Model 4    0.1751336438 0.1788627543   2.221245e-02
## Model 5              NA 0.0060159119   2.605182e-04
## Model 6    0.0032572051           NA   4.449708e-05
## Model 7              NA           NA   3.202380e-04
## Model 8              NA           NA   3.365506e-02
</code></pre><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#sink()</span></span><br></pre></td></tr></table></figure>
<h3 id="Plot-of-density-of-estimator"><a href="#Plot-of-density-of-estimator" class="headerlink" title="Plot of density of estimator"></a>Plot of density of estimator</h3><p>Number of replication N = 10<sup>5</sup></p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># In Distribution pic, blue line is true beta, red line is betahat</span></span><br><span class="line">foo = expression(hat(beta)[<span class="number">1</span>], hat(beta)[<span class="number">2</span>],hat(beta)[<span class="number">3</span>],</span><br><span class="line">                 hat(beta)[<span class="number">4</span>],hat(beta)[<span class="number">5</span>],hat(beta)[<span class="number">6</span>])</span><br><span class="line"><span class="keyword">for</span> (i <span class="keyword">in</span> <span class="number">1</span>:length(beta)){</span><br><span class="line">  <span class="comment"># mypath &lt;- file.path(getwd(),&quot;Figure&quot;,paste(&quot;density_beta_&quot;,i, &quot;.jpeg&quot;, sep = &quot;&quot;))</span></span><br><span class="line">  <span class="comment"># jpeg(mypath, height = 8, width = 8, units = &apos;in&apos;, res = 300)</span></span><br><span class="line">  <span class="comment"># beta_{i}</span></span><br><span class="line">  par(mfrow=c(<span class="number">2</span>,<span class="number">2</span>))</span><br><span class="line">  plot(density(mat.beta[,i]), </span><br><span class="line">       xlab = foo[[i]], </span><br><span class="line">       main = <span class="string">&quot;Distribution&quot;</span>)</span><br><span class="line">  curve(dnorm(x, mat.betahat[length(vecN),i], </span><br><span class="line">              sqrt(mat.vebh[length(vecN),i])), </span><br><span class="line">        col=<span class="string">&quot;red&quot;</span>, add=<span class="literal">TRUE</span>)</span><br><span class="line">  abline(v=mat.betahat[length(vecN),i], </span><br><span class="line">         col = <span class="string">&quot;red&quot;</span>, lty = <span class="number">2</span>)</span><br><span class="line">  abline(v=beta[i], col = <span class="string">&quot;blue&quot;</span>, lty = <span class="number">2</span>)</span><br><span class="line">  <span class="comment"># &quot;T&quot; for &quot;True&quot;, &quot;S&quot; for &quot;Simulated&quot;</span></span><br><span class="line">  legend(<span class="string">&quot;topright&quot;</span>, legend=c(<span class="string">&quot;T&quot;</span>, <span class="string">&quot;S&quot;</span>), </span><br><span class="line">         lty=<span class="number">1</span>, col=c(<span class="string">&quot;red&quot;</span>, <span class="string">&quot;black&quot;</span>))</span><br><span class="line">  <span class="comment"># dev.off()</span></span><br><span class="line">  <span class="comment">##</span></span><br><span class="line">  <span class="comment"># mypath &lt;- file.path(getwd(),&quot;Figure&quot;,paste(&quot;hist_beta_&quot;,i, &quot;.jpeg&quot;, sep = &quot;&quot;))</span></span><br><span class="line">  <span class="comment"># jpeg(mypath, height = 8, width = 8, units = &apos;in&apos;, res = 300)</span></span><br><span class="line">  hist(mat.beta[,i], prob=<span class="literal">TRUE</span>, </span><br><span class="line">       xlab = foo[[i]], </span><br><span class="line">       main = <span class="string">&quot;Histogram&quot;</span>)</span><br><span class="line">  curve(dnorm(x, mat.betahat[length(vecN),i], </span><br><span class="line">              sd=sqrt(mat.vebh[length(vecN),i])), </span><br><span class="line">        col=<span class="string">&quot;red&quot;</span>, </span><br><span class="line">        add=<span class="literal">TRUE</span>)</span><br><span class="line">  <span class="comment"># &quot;T&quot; for &quot;True&quot;, &quot;S&quot; for &quot;Simulated&quot;</span></span><br><span class="line">  <span class="comment"># legend(&quot;topright&quot;, legend=c(&quot;T&quot;, &quot;S&quot;), </span></span><br><span class="line">  <span class="comment">#        lty=1, col=c(&quot;red&quot;, &quot;black&quot;))</span></span><br><span class="line">  <span class="comment"># dev.off()</span></span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<p><img src="/images/MC_FF5_files/figure-markdown_github/unnamed-chunk-12-1.png" alt=""><img src="/images/MC_FF5_files/figure-markdown_github/unnamed-chunk-12-2.png" alt=""><img src="/images/MC_FF5_files/figure-markdown_github/unnamed-chunk-12-3.png" alt=""><img src="/images/MC_FF5_files/figure-markdown_github/unnamed-chunk-12-4.png" alt=""><img src="/images/MC_FF5_files/figure-markdown_github/unnamed-chunk-12-5.png" alt=""><img src="/images/MC_FF5_files/figure-markdown_github/unnamed-chunk-12-6.png" alt=""></p>
<h3 id="Finding-i"><a href="#Finding-i" class="headerlink" title="Finding (i)"></a>Finding (i)</h3><ol>
<li>The O.L.S. estimators of the unknown coefficients and error variance are unbiased</li>
</ol>
<h4 id="Plot-of-betahat"><a href="#Plot-of-betahat" class="headerlink" title="Plot of betahat"></a>Plot of betahat</h4><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">foo = expression(hat(beta)[<span class="number">1</span>], hat(beta)[<span class="number">2</span>],hat(beta)[<span class="number">3</span>],</span><br><span class="line">                 hat(beta)[<span class="number">4</span>],hat(beta)[<span class="number">5</span>],hat(beta)[<span class="number">6</span>])</span><br><span class="line"><span class="keyword">for</span> (i <span class="keyword">in</span> <span class="number">1</span>:length(beta)){</span><br><span class="line">  <span class="comment"># mypath &lt;- file.path(getwd(),&quot;Figure&quot;,paste(&quot;i_OLS_betahat_&quot;,i, &quot;.jpeg&quot;, sep = &quot;&quot;))</span></span><br><span class="line">  <span class="comment"># jpeg(mypath, height = 8, width = 8, units = &apos;in&apos;, res = 300)</span></span><br><span class="line">  plot(vecN, mat.betahat[,i], </span><br><span class="line">       type=<span class="string">&quot;b&quot;</span>, </span><br><span class="line">       xlab = <span class="string">&quot;#Replication&quot;</span>, </span><br><span class="line">       ylab = foo[[i]], </span><br><span class="line">       main=<span class="string">&quot;Convergence Graph&quot;</span>)</span><br><span class="line">  abline(h=beta[i], col = <span class="string">&quot;blue&quot;</span>, lty = <span class="number">2</span>)</span><br><span class="line">  <span class="comment"># dev.off()</span></span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<p><img src="/images/MC_FF5_files/figure-markdown_github/unnamed-chunk-13-1.png" alt=""><img src="/images/MC_FF5_files/figure-markdown_github/unnamed-chunk-13-2.png" alt=""><img src="/images/MC_FF5_files/figure-markdown_github/unnamed-chunk-13-3.png" alt=""><img src="/images/MC_FF5_files/figure-markdown_github/unnamed-chunk-13-4.png" alt=""><img src="/images/MC_FF5_files/figure-markdown_github/unnamed-chunk-13-5.png" alt=""><img src="/images/MC_FF5_files/figure-markdown_github/unnamed-chunk-13-6.png" alt=""></p>
<p>Plot in one graph:</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># In one graph</span></span><br><span class="line">mydimnames1 &lt;- list(vecN, </span><br><span class="line">                    name=c(<span class="string">&quot;beta_1&quot;</span>, <span class="string">&quot;beta_2&quot;</span>, <span class="string">&quot;beta_3&quot;</span>, </span><br><span class="line">                           <span class="string">&quot;beta_4&quot;</span>, <span class="string">&quot;beta_5&quot;</span>, <span class="string">&quot;beta_6&quot;</span>))</span><br><span class="line">dimnames(mat.betahat)=mydimnames1</span><br><span class="line"><span class="comment">#</span></span><br><span class="line">mydimnames2 &lt;- list(vecN, </span><br><span class="line">                    name=c(<span class="string">&quot;beta_1&quot;</span>, <span class="string">&quot;beta_2&quot;</span>, <span class="string">&quot;beta_3&quot;</span>, </span><br><span class="line">                           <span class="string">&quot;beta_4&quot;</span>, <span class="string">&quot;beta_5&quot;</span>, <span class="string">&quot;beta_6&quot;</span>))</span><br><span class="line">trueb &lt;- t(replicate(length(vecN),beta))</span><br><span class="line">dimnames(trueb)=mydimnames2</span><br><span class="line"><span class="comment">#</span></span><br><span class="line">method = gl(<span class="number">2</span>,(length(beta))*length(vecN),</span><br><span class="line">            (length(beta))*length(vecN)*<span class="number">2</span>, </span><br><span class="line">            labels = c(<span class="string">&quot;Simulated&quot;</span>, <span class="string">&quot;True&quot;</span>))</span><br><span class="line">tempdata &lt;- as.data.frame(as.table(cbind(mat.betahat,trueb)))</span><br><span class="line">colnames(tempdata) &lt;- c(<span class="string">&quot;N&quot;</span>,<span class="string">&quot;beta&quot;</span>,<span class="string">&quot;Value&quot;</span>)</span><br><span class="line">tempdata$Method &lt;- method</span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="keyword">library</span>(ggplot2)</span><br><span class="line">ggplot(data = tempdata, aes(x = N, </span><br><span class="line">                            y = Value,</span><br><span class="line">                            linetype = Method,</span><br><span class="line">                            colour = beta,</span><br><span class="line">                            group = interaction(beta,Method))) + </span><br><span class="line">  geom_line(size = <span class="number">1</span>) + </span><br><span class="line">  xlab(<span class="string">&quot;#Replication&quot;</span>) + </span><br><span class="line">  ylab(expression(hat(beta))) + </span><br><span class="line">  <span class="comment"># color ref: http://sape.inf.usi.ch/quick-reference/ggplot2/colour</span></span><br><span class="line">  <span class="comment"># linetype ref: http://sape.inf.usi.ch/quick-reference/ggplot2/linetype</span></span><br><span class="line">  theme_light() +</span><br><span class="line">  theme(axis.text.x = element_text(face=<span class="string">&quot;bold&quot;</span>, color=<span class="string">&quot;#993333&quot;</span>, </span><br><span class="line">                                   size=<span class="number">10</span>, angle=<span class="number">45</span>),</span><br><span class="line">        axis.text.y = element_text(face=<span class="string">&quot;bold&quot;</span>, color=<span class="string">&quot;#993333&quot;</span>, </span><br><span class="line">                                   size=<span class="number">10</span>, angle=<span class="number">45</span>))</span><br></pre></td></tr></table></figure>
<p><img src="/images/MC_FF5_files/figure-markdown_github/unnamed-chunk-14-1.png" alt=""></p>
<p>The difference between true value and the last similated value</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">abs(beta-mat.betahat[length(vecN),])</span><br></pre></td></tr></table></figure>
<pre><code>##  (Intercept)         rmrf          smb          hml          rmw 
## 5.097693e-05 4.548356e-06 1.277153e-04 5.847280e-05 1.093913e-04 
##          cma 
## 1.619033e-04
</code></pre><h4 id="Plot-of-variance-of-betahat"><a href="#Plot-of-variance-of-betahat" class="headerlink" title="Plot of variance of betahat"></a>Plot of variance of betahat</h4><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># beta - betahat ~ N(0, sigma^2 (X^T X)^-1)</span></span><br><span class="line">var.beta &lt;- sig2e*solve(t(X)%*%X)</span><br><span class="line">foo2 = expression(<span class="string">&quot;var of &quot;</span>~hat(beta)[<span class="number">1</span>], </span><br><span class="line">                  <span class="string">&quot;var of &quot;</span>~hat(beta)[<span class="number">2</span>],</span><br><span class="line">                  <span class="string">&quot;var of &quot;</span>~hat(beta)[<span class="number">3</span>],</span><br><span class="line">                  <span class="string">&quot;var of &quot;</span>~hat(beta)[<span class="number">4</span>],</span><br><span class="line">                  <span class="string">&quot;var of &quot;</span>~hat(beta)[<span class="number">5</span>],</span><br><span class="line">                  <span class="string">&quot;var of &quot;</span>~hat(beta)[<span class="number">6</span>])</span><br><span class="line"><span class="keyword">for</span> (i <span class="keyword">in</span> <span class="number">1</span>:length(beta)){</span><br><span class="line">  <span class="comment"># mypath &lt;- file.path(getwd(),&quot;Figure&quot;,paste(&quot;i_var_betahat_&quot;,i, &quot;.jpeg&quot;, sep = &quot;&quot;))</span></span><br><span class="line">  <span class="comment"># jpeg(mypath, height = 8, width = 8, units = &apos;in&apos;, res = 300)</span></span><br><span class="line">  plot(vecN, mat.vebh[,i], </span><br><span class="line">       type=<span class="string">&quot;b&quot;</span>, xlab = <span class="string">&quot;#Replication&quot;</span>, </span><br><span class="line">       ylab = foo2[[i]], main=<span class="string">&quot;Convergence Graph&quot;</span>)</span><br><span class="line">  abline(h=var.beta[i,i], col = <span class="string">&quot;blue&quot;</span>, lty = <span class="number">2</span>)</span><br><span class="line">  <span class="comment"># dev.off()</span></span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<p><img src="/images/MC_FF5_files/figure-markdown_github/unnamed-chunk-16-1.png" alt=""><img src="/images/MC_FF5_files/figure-markdown_github/unnamed-chunk-16-2.png" alt=""><img src="/images/MC_FF5_files/figure-markdown_github/unnamed-chunk-16-3.png" alt=""><img src="/images/MC_FF5_files/figure-markdown_github/unnamed-chunk-16-4.png" alt=""><img src="/images/MC_FF5_files/figure-markdown_github/unnamed-chunk-16-5.png" alt=""><img src="/images/MC_FF5_files/figure-markdown_github/unnamed-chunk-16-6.png" alt=""></p>
<p>The difference between true value and the last similated value</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">abs(diag(var.beta)-mat.vebh[length(vecN),])</span><br></pre></td></tr></table></figure>
<pre><code>##                      rmrf          smb          hml          rmw 
## 1.275990e-06 3.146077e-07 7.275822e-06 2.791952e-06 8.092901e-05 
##          cma 
## 1.124775e-04
</code></pre><h4 id="Plot-of-error-variance"><a href="#Plot-of-error-variance" class="headerlink" title="Plot of error variance"></a>Plot of error variance</h4><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Error Variance</span></span><br><span class="line"><span class="comment"># Unbised estimater of sigma^2</span></span><br><span class="line"><span class="comment"># mypath &lt;- file.path(getwd(),&quot;Figure&quot;,&quot;i_var_err.jpeg&quot;)</span></span><br><span class="line"><span class="comment"># jpeg(mypath, height = 8, width = 8, units = &apos;in&apos;, res = 300)</span></span><br><span class="line">plot(vecN, vec.err.varh, type=<span class="string">&quot;b&quot;</span>, xlab = <span class="string">&quot;#Replication&quot;</span>, ylab = <span class="string">&quot;Error Var.&quot;</span>)</span><br><span class="line">abline(h=sig2e, col = <span class="string">&quot;blue&quot;</span>, lty = <span class="number">2</span>)</span><br></pre></td></tr></table></figure>
<p><img src="/images/MC_FF5_files/figure-markdown_github/unnamed-chunk-18-1.png" alt=""></p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># dev.off()</span></span><br></pre></td></tr></table></figure>
<p>The difference between true value and the last similated value:</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">abs(sig2e-vec.err.varh[length(vecN)])</span><br></pre></td></tr></table></figure>
<pre><code>## [1] 4.572658e-05
</code></pre><h3 id="Finding-ii"><a href="#Finding-ii" class="headerlink" title="Finding (ii)"></a>Finding (ii)</h3><ol>
<li>The &#x201C;correct&#x201D; meaning of a 100(1&#x2010;<em>&#x3B1;</em>)% confidence interval of an unknown coefficient</li>
</ol>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (i <span class="keyword">in</span> <span class="number">1</span>:length(beta)){</span><br><span class="line">  <span class="comment"># mypath &lt;- file.path(getwd(),&quot;Figure&quot;,paste(&quot;ii_prob_beta_&quot;,i, &quot;.jpeg&quot;, sep = &quot;&quot;))</span></span><br><span class="line">  <span class="comment"># jpeg(mypath, height = 8, width = 8, units = &apos;in&apos;, res = 300)</span></span><br><span class="line">  plot(vecN, prob.flag.beta[,i], type=<span class="string">&quot;b&quot;</span>, xlab = <span class="string">&quot;#Replication&quot;</span>, ylab = <span class="string">&quot;Prob(CI contains beta)&quot;</span>, main=foo[[i]], ylim = c(<span class="number">0.6</span>,<span class="number">1</span>))</span><br><span class="line">  abline(h=<span class="number">0.95</span>, col = <span class="string">&quot;blue&quot;</span>, lty = <span class="number">2</span>)</span><br><span class="line">  <span class="comment"># dev.off()</span></span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<p><img src="/images/MC_FF5_files/figure-markdown_github/unnamed-chunk-20-1.png" alt=""><img src="/images/MC_FF5_files/figure-markdown_github/unnamed-chunk-20-2.png" alt=""><img src="/images/MC_FF5_files/figure-markdown_github/unnamed-chunk-20-3.png" alt=""><img src="/images/MC_FF5_files/figure-markdown_github/unnamed-chunk-20-4.png" alt=""><img src="/images/MC_FF5_files/figure-markdown_github/unnamed-chunk-20-5.png" alt=""><img src="/images/MC_FF5_files/figure-markdown_github/unnamed-chunk-20-6.png" alt=""></p>
<p>Plot in one graph:</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># in one graph</span></span><br><span class="line">mydimnames &lt;- list(vecN, name=c(<span class="string">&quot;beta_1&quot;</span>, <span class="string">&quot;beta_2&quot;</span>, <span class="string">&quot;beta_3&quot;</span>,</span><br><span class="line">                                <span class="string">&quot;beta_4&quot;</span>, <span class="string">&quot;beta_5&quot;</span>, <span class="string">&quot;beta_6&quot;</span>))</span><br><span class="line">dimnames(prob.flag.beta)=mydimnames</span><br><span class="line">tempdata &lt;- as.data.frame(as.table(prob.flag.beta))</span><br><span class="line"><span class="keyword">library</span>(ggplot2)</span><br><span class="line">ggplot(data = tempdata, aes(x = Var1, y=Freq, group = name)) + </span><br><span class="line">  geom_line(aes(linetype=name, color = name), size=<span class="number">1</span>) + </span><br><span class="line">  xlab(<span class="string">&quot;#Replication&quot;</span>) + </span><br><span class="line">  ylab(expression(<span class="string">&quot;Pr(CI contains &quot;</span>~beta~<span class="string">&quot;)&quot;</span>)) + </span><br><span class="line">  ylim(<span class="number">0.9</span>,<span class="number">1</span>) + </span><br><span class="line">  geom_hline(yintercept = <span class="number">.95</span>, color = <span class="string">&quot;blue&quot;</span>, linetype=<span class="string">&quot;dotted&quot;</span>) +</span><br><span class="line">  theme_light() +</span><br><span class="line">  theme(axis.text.x = element_text(face=<span class="string">&quot;bold&quot;</span>, color=<span class="string">&quot;#993333&quot;</span>, </span><br><span class="line">                                   size=<span class="number">10</span>, angle=<span class="number">45</span>),</span><br><span class="line">        axis.text.y = element_text(face=<span class="string">&quot;bold&quot;</span>, color=<span class="string">&quot;#993333&quot;</span>, </span><br><span class="line">                                   size=<span class="number">10</span>, angle=<span class="number">45</span>))</span><br></pre></td></tr></table></figure>
<p><img src="/images/MC_FF5_files/figure-markdown_github/unnamed-chunk-21-1.png" alt=""></p>
<p>The difference between true value and the last similated value</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">abs(<span class="number">0.95</span>-prob.flag.beta[length(vecN),])</span><br></pre></td></tr></table></figure>
<pre><code>##  beta_1  beta_2  beta_3  beta_4  beta_5  beta_6 
## 0.00012 0.00079 0.00048 0.00018 0.00194 0.00167
</code></pre><h3 id="Finding-iii"><a href="#Finding-iii" class="headerlink" title="Finding (iii)"></a>Finding (iii)</h3><ol>
<li>The significance level of the t test for testing a linear hypothesis concerning one or more coefficients is the probability of committing a Type I error</li>
</ol>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (i <span class="keyword">in</span> <span class="number">1</span>:length(beta)){</span><br><span class="line">  <span class="comment"># mypath &lt;- file.path(getwd(),&quot;Figure&quot;,paste(&quot;iii_prob_type1err_&quot;,i, &quot;.jpeg&quot;, sep = &quot;&quot;))</span></span><br><span class="line">  <span class="comment"># jpeg(mypath, height = 8, width = 8, units = &apos;in&apos;, res = 300)</span></span><br><span class="line">  plot(vecN, prob.flag.type1[,i],</span><br><span class="line">       type=<span class="string">&quot;b&quot;</span>, xlab = <span class="string">&quot;#Replication&quot;</span>, </span><br><span class="line">       ylab = <span class="string">&quot;Prob(Type 1 Error)&quot;</span>, </span><br><span class="line">       main=foo[[i]], ylim = c(<span class="number">0</span>,<span class="number">1</span>))</span><br><span class="line">  abline(h=<span class="number">0.05</span>, col = <span class="string">&quot;blue&quot;</span>, lty = <span class="number">2</span>)</span><br><span class="line">  <span class="comment"># dev.off()</span></span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<p><img src="/images/MC_FF5_files/figure-markdown_github/unnamed-chunk-23-1.png" alt=""><img src="/images/MC_FF5_files/figure-markdown_github/unnamed-chunk-23-2.png" alt=""><img src="/images/MC_FF5_files/figure-markdown_github/unnamed-chunk-23-3.png" alt=""><img src="/images/MC_FF5_files/figure-markdown_github/unnamed-chunk-23-4.png" alt=""><img src="/images/MC_FF5_files/figure-markdown_github/unnamed-chunk-23-5.png" alt=""><img src="/images/MC_FF5_files/figure-markdown_github/unnamed-chunk-23-6.png" alt=""></p>
<p>Plot in one graph:</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># in one graph</span></span><br><span class="line">mydimnames &lt;- list(vecN, name=c(<span class="string">&quot;beta_1&quot;</span>, <span class="string">&quot;beta_2&quot;</span>, <span class="string">&quot;beta_3&quot;</span>, </span><br><span class="line">                                <span class="string">&quot;beta_4&quot;</span>, <span class="string">&quot;beta_5&quot;</span>, <span class="string">&quot;beta_6&quot;</span>))</span><br><span class="line">dimnames(prob.flag.type1)=mydimnames</span><br><span class="line">tempdata &lt;- as.data.frame(as.table(prob.flag.type1))</span><br><span class="line"><span class="keyword">library</span>(ggplot2)</span><br><span class="line">ggplot(data = tempdata, aes(x = Var1, y=Freq, group = name)) + </span><br><span class="line">  geom_line(aes(linetype = name, color = name), size = <span class="number">1</span>) + </span><br><span class="line">  xlab(<span class="string">&quot;#Replication&quot;</span>) + </span><br><span class="line">  ylab(<span class="string">&quot;Prob(Type 1 Error)&quot;</span>) + </span><br><span class="line">  ylim(<span class="number">0</span>,<span class="number">0.1</span>) + </span><br><span class="line">  geom_hline(yintercept = <span class="number">.05</span>, color = <span class="string">&quot;blue&quot;</span>, linetype = <span class="string">&quot;dotted&quot;</span>)+</span><br><span class="line">  theme_light() +</span><br><span class="line">  theme(axis.text.x = element_text(face=<span class="string">&quot;bold&quot;</span>, color=<span class="string">&quot;#993333&quot;</span>, </span><br><span class="line">                                   size=<span class="number">10</span>, angle=<span class="number">45</span>),</span><br><span class="line">        axis.text.y = element_text(face=<span class="string">&quot;bold&quot;</span>, color=<span class="string">&quot;#993333&quot;</span>, </span><br><span class="line">                                   size=<span class="number">10</span>, angle=<span class="number">45</span>))</span><br></pre></td></tr></table></figure>
<p><img src="/images/MC_FF5_files/figure-markdown_github/unnamed-chunk-24-1.png" alt=""></p>
<p>The difference between true value and the last similated value</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">abs(<span class="number">0.05</span>-prob.flag.type1[length(vecN),])</span><br></pre></td></tr></table></figure>
<pre><code>##  beta_1  beta_2  beta_3  beta_4  beta_5  beta_6 
## 0.00012 0.00079 0.00048 0.00018 0.00194 0.00167
</code></pre><h3 id="Finding-iv"><a href="#Finding-iv" class="headerlink" title="Finding (iv)"></a>Finding (iv)</h3><ol>
<li>The t test is unbiased</li>
</ol>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (i <span class="keyword">in</span> <span class="number">1</span>:length(beta)){</span><br><span class="line">  <span class="comment"># mypath &lt;- file.path(getwd(),&quot;Figure&quot;,paste(&quot;iv_tstat_&quot;,i, &quot;.jpeg&quot;, sep = &quot;&quot;))</span></span><br><span class="line">  <span class="comment"># jpeg(mypath, height = 8, width = 8, units = &apos;in&apos;, res = 300)</span></span><br><span class="line">  plot(vecN, mat.t.stathat[,i], type=<span class="string">&quot;b&quot;</span>, xlab = <span class="string">&quot;#Replication&quot;</span>, ylab = <span class="string">&quot;t-stat&quot;</span>, main=foo[[i]])</span><br><span class="line">  abline(h=<span class="number">0</span>, col = <span class="string">&quot;blue&quot;</span>, lty = <span class="number">2</span>)</span><br><span class="line">  <span class="comment"># dev.off()</span></span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<p><img src="/images/MC_FF5_files/figure-markdown_github/unnamed-chunk-26-1.png" alt=""><img src="/images/MC_FF5_files/figure-markdown_github/unnamed-chunk-26-2.png" alt=""><img src="/images/MC_FF5_files/figure-markdown_github/unnamed-chunk-26-3.png" alt=""><img src="/images/MC_FF5_files/figure-markdown_github/unnamed-chunk-26-4.png" alt=""><img src="/images/MC_FF5_files/figure-markdown_github/unnamed-chunk-26-5.png" alt=""><img src="/images/MC_FF5_files/figure-markdown_github/unnamed-chunk-26-6.png" alt=""></p>
<p>Plot in one graph:</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># in one graph</span></span><br><span class="line">mydimnames &lt;- list(vecN, name=c(<span class="string">&quot;beta_1&quot;</span>, <span class="string">&quot;beta_2&quot;</span>, <span class="string">&quot;beta_3&quot;</span>, </span><br><span class="line">                                <span class="string">&quot;beta_4&quot;</span>, <span class="string">&quot;beta_5&quot;</span>, <span class="string">&quot;beta_6&quot;</span>))</span><br><span class="line">dimnames(mat.t.stathat)=mydimnames</span><br><span class="line">tempdata &lt;- as.data.frame(as.table(mat.t.stathat))</span><br><span class="line"><span class="keyword">library</span>(ggplot2)</span><br><span class="line">ggplot(data = tempdata, aes(x = Var1, y=Freq, group = name)) + </span><br><span class="line">  geom_line(aes(linetype = name, color = name), size = <span class="number">1</span>) + </span><br><span class="line">  xlab(<span class="string">&quot;#Replication&quot;</span>) + </span><br><span class="line">  ylab(<span class="string">&quot;t-stat&quot;</span>) + </span><br><span class="line">  geom_hline(yintercept = <span class="number">0</span>, color = <span class="string">&quot;blue&quot;</span>, linetype = <span class="string">&quot;dotted&quot;</span>) +</span><br><span class="line">  theme_light() +</span><br><span class="line">  theme(axis.text.x = element_text(face=<span class="string">&quot;bold&quot;</span>, color=<span class="string">&quot;#993333&quot;</span>, </span><br><span class="line">                                   size=<span class="number">10</span>, angle=<span class="number">45</span>),</span><br><span class="line">        axis.text.y = element_text(face=<span class="string">&quot;bold&quot;</span>, color=<span class="string">&quot;#993333&quot;</span>, </span><br><span class="line">                                   size=<span class="number">10</span>, angle=<span class="number">45</span>))</span><br></pre></td></tr></table></figure>
<p><img src="/images/MC_FF5_files/figure-markdown_github/unnamed-chunk-27-1.png" alt=""></p>
<p>The difference between true value and the last similated value</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">abs(<span class="number">0</span>-mat.t.stathat[length(vecN),])</span><br></pre></td></tr></table></figure>
<pre><code>##       beta_1       beta_2       beta_3       beta_4       beta_5 
## 0.0021438691 0.0002507301 0.0029878315 0.0013417811 0.0013706685 
##       beta_6 
## 0.0019628747
</code></pre><h3 id="Finding-v"><a href="#Finding-v" class="headerlink" title="Finding (v)"></a>Finding (v)</h3><ol>
<li>The result in Part iii) no longer holds if some relevant explanatory variables have been omitted from the model</li>
</ol>
<p>We omitt the variable <code>rmrf</code> (<em>K</em><sub><em>m</em></sub>&#x2005;&#x2212;&#x2005;<em>R</em><sub><em>f</em></sub>).</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">foo3 = expression(hat(beta)[<span class="number">12</span>], hat(beta)[<span class="number">32</span>],hat(beta)[<span class="number">42</span>],hat(beta)[<span class="number">52</span>],hat(beta)[<span class="number">62</span>])</span><br><span class="line"><span class="keyword">for</span> (i <span class="keyword">in</span> <span class="number">1</span>:(length(beta)-<span class="number">1</span>)){</span><br><span class="line">  <span class="comment"># mypath &lt;- file.path(getwd(),&quot;Figure&quot;,paste(&quot;v_prob_type1err_&quot;,i, &quot;.jpeg&quot;, sep = &quot;&quot;))</span></span><br><span class="line">  <span class="comment"># jpeg(mypath, height = 8, width = 8, units = &apos;in&apos;, res = 300)</span></span><br><span class="line">  plot(vecN, prob.flag.type1.2[,i], type=<span class="string">&quot;b&quot;</span>, xlab = <span class="string">&quot;#Replication&quot;</span>, ylab = <span class="string">&quot;Prob(Type 1 Error)&quot;</span>, main=foo3[[i]], ylim = c(<span class="number">0</span>,<span class="number">1</span>))</span><br><span class="line">  abline(h=<span class="number">0.05</span>, col = <span class="string">&quot;blue&quot;</span>, lty = <span class="number">2</span>)</span><br><span class="line">  <span class="comment"># dev.off()</span></span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<p><img src="/images/MC_FF5_files/figure-markdown_github/unnamed-chunk-29-1.png" alt=""><img src="/images/MC_FF5_files/figure-markdown_github/unnamed-chunk-29-2.png" alt=""><img src="/images/MC_FF5_files/figure-markdown_github/unnamed-chunk-29-3.png" alt=""><img src="/images/MC_FF5_files/figure-markdown_github/unnamed-chunk-29-4.png" alt=""><img src="/images/MC_FF5_files/figure-markdown_github/unnamed-chunk-29-5.png" alt=""></p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># in one graph</span></span><br><span class="line">mydimnames &lt;- list(vecN, name=c(<span class="string">&quot;beta_12&quot;</span>, <span class="string">&quot;beta_32&quot;</span>, </span><br><span class="line">                                <span class="string">&quot;beta_42&quot;</span>, <span class="string">&quot;beta_52&quot;</span>, <span class="string">&quot;beta_62&quot;</span>))</span><br><span class="line">dimnames(prob.flag.type1.2)=mydimnames</span><br><span class="line">tempdata &lt;- as.data.frame(as.table(prob.flag.type1.2))</span><br><span class="line"><span class="keyword">library</span>(ggplot2)</span><br><span class="line">ggplot(data = tempdata, aes(x = Var1, y=Freq, group = name)) + </span><br><span class="line">  geom_line(aes(linetype = name, color = name), size = <span class="number">1</span>) + </span><br><span class="line">  xlab(<span class="string">&quot;#Replication&quot;</span>) + </span><br><span class="line">  ylab(<span class="string">&quot;Prob(Type 1 Error)&quot;</span>)+ </span><br><span class="line">  ylim(<span class="number">0</span>,<span class="number">1</span>) + </span><br><span class="line">  geom_hline(yintercept = <span class="number">0.05</span>, color = <span class="string">&quot;blue&quot;</span>, linetype = <span class="string">&quot;dotted&quot;</span>) +</span><br><span class="line">  ggtitle(<span class="string">&quot;Model with omitting variable&quot;</span>) +</span><br><span class="line">  theme_light() +</span><br><span class="line">  theme(axis.text.x = element_text(face=<span class="string">&quot;bold&quot;</span>, color=<span class="string">&quot;#993333&quot;</span>, </span><br><span class="line">                                   size=<span class="number">10</span>, angle=<span class="number">45</span>),</span><br><span class="line">        axis.text.y = element_text(face=<span class="string">&quot;bold&quot;</span>, color=<span class="string">&quot;#993333&quot;</span>, </span><br><span class="line">                                   size=<span class="number">10</span>, angle=<span class="number">45</span>))</span><br></pre></td></tr></table></figure>
<p><img src="/images/MC_FF5_files/figure-markdown_github/unnamed-chunk-30-1.png" alt=""></p>
<p>The difference between true value and the last similated value</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">abs(<span class="number">0.05</span>-prob.flag.type1.2[length(vecN),])</span><br></pre></td></tr></table></figure>
<pre><code>## beta_12 beta_32 beta_42 beta_52 beta_62 
## 0.24885 0.94999 0.95000 0.95000 0.95000
</code></pre><h3 id="Finding-vi"><a href="#Finding-vi" class="headerlink" title="Finding (vi)"></a>Finding (vi)</h3><ol>
<li>The estimator of say, the coefficient of X2, is no longer unbiased if the decision of whether to include X1 in the model is dependent on the outcome of a t test. Based on your findings, discuss the wider implications of &#x201C;model selection&#x201D; for statistical modeling and the lessons to be learnt for practitioners.</li>
</ol>
<h4 id="Plot-of-betahat-of-omitting-model"><a href="#Plot-of-betahat-of-omitting-model" class="headerlink" title="Plot of betahat of omitting model"></a>Plot of betahat of omitting model</h4><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">temp &lt;- <span class="number">1</span>:length(beta)</span><br><span class="line">nbv &lt;- temp[-<span class="number">2</span>]</span><br><span class="line"><span class="keyword">for</span> (i <span class="keyword">in</span> <span class="number">1</span>:(length(beta)-<span class="number">1</span>)){</span><br><span class="line">  <span class="comment"># mypath &lt;- file.path(getwd(),&quot;Figure&quot;,paste(&quot;vi_batahat_&quot;,i, &quot;.jpeg&quot;, sep = &quot;&quot;))</span></span><br><span class="line">  <span class="comment"># jpeg(mypath, height = 8, width = 8, units = &apos;in&apos;, res = 300)</span></span><br><span class="line">  plot(vecN, mat.betahat2[,i], type=<span class="string">&quot;b&quot;</span>, xlab = <span class="string">&quot;#Replication&quot;</span>, ylab = foo3[[i]], main=<span class="string">&quot;Convergence Graph&quot;</span>)</span><br><span class="line">  abline(h=beta[nbv[i]], col = <span class="string">&quot;blue&quot;</span>, lty = <span class="number">2</span>)</span><br><span class="line">  <span class="comment"># dev.off()</span></span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<p><img src="/images/MC_FF5_files/figure-markdown_github/unnamed-chunk-32-1.png" alt=""><img src="/images/MC_FF5_files/figure-markdown_github/unnamed-chunk-32-2.png" alt=""><img src="/images/MC_FF5_files/figure-markdown_github/unnamed-chunk-32-3.png" alt=""><img src="/images/MC_FF5_files/figure-markdown_github/unnamed-chunk-32-4.png" alt=""><img src="/images/MC_FF5_files/figure-markdown_github/unnamed-chunk-32-5.png" alt=""></p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># One graph</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line">mydimnames1 &lt;- list(vecN, </span><br><span class="line">                    name=c(<span class="string">&quot;beta_12&quot;</span>, <span class="string">&quot;beta_32&quot;</span>, </span><br><span class="line">                           <span class="string">&quot;beta_42&quot;</span>, <span class="string">&quot;beta_52&quot;</span>, <span class="string">&quot;beta_62&quot;</span>))</span><br><span class="line">dimnames(mat.betahat2)=mydimnames1</span><br><span class="line"><span class="comment">#</span></span><br><span class="line">mydimnames2 &lt;- list(vecN, </span><br><span class="line">                    name=c(<span class="string">&quot;beta_12&quot;</span>, <span class="string">&quot;beta_32&quot;</span>, </span><br><span class="line">                           <span class="string">&quot;beta_42&quot;</span>, <span class="string">&quot;beta_52&quot;</span>, <span class="string">&quot;beta_62&quot;</span>))</span><br><span class="line">trueb &lt;- t(replicate(length(vecN),beta[nbv]))</span><br><span class="line">dimnames(trueb)=mydimnames2</span><br><span class="line"><span class="comment">#</span></span><br><span class="line">method = gl(<span class="number">2</span>,(length(beta)-<span class="number">1</span>)*length(vecN),</span><br><span class="line">            (length(beta)-<span class="number">1</span>)*length(vecN)*<span class="number">2</span>, </span><br><span class="line">            labels = c(<span class="string">&quot;Simulated&quot;</span>, <span class="string">&quot;True&quot;</span>)) </span><br><span class="line">tempdata &lt;- as.data.frame(as.table(cbind(mat.betahat2,trueb)))</span><br><span class="line">colnames(tempdata) &lt;- c(<span class="string">&quot;N&quot;</span>,<span class="string">&quot;beta&quot;</span>,<span class="string">&quot;Value&quot;</span>)</span><br><span class="line">tempdata$Method &lt;- method</span><br><span class="line"></span><br><span class="line"><span class="keyword">library</span>(ggplot2)</span><br><span class="line">ggplot(data = tempdata, aes(x = N, y = Value, </span><br><span class="line">                            linetype = Method, colour = beta, </span><br><span class="line">                            group = interaction(beta, Method))) +</span><br><span class="line">  geom_line(size = <span class="number">1</span>) + </span><br><span class="line">  xlab(<span class="string">&quot;#Replication&quot;</span>) + </span><br><span class="line">  ylab(expression(hat(beta))) + </span><br><span class="line">  ggtitle(<span class="string">&quot;Model with omitting variable&quot;</span>) +</span><br><span class="line">  theme_light() +</span><br><span class="line">  theme(axis.text.x = element_text(face=<span class="string">&quot;bold&quot;</span>, color=<span class="string">&quot;#993333&quot;</span>, </span><br><span class="line">                                   size=<span class="number">10</span>, angle=<span class="number">45</span>),</span><br><span class="line">        axis.text.y = element_text(face=<span class="string">&quot;bold&quot;</span>, color=<span class="string">&quot;#993333&quot;</span>, </span><br><span class="line">                                   size=<span class="number">10</span>, angle=<span class="number">45</span>))</span><br></pre></td></tr></table></figure>
<p><img src="/images/MC_FF5_files/figure-markdown_github/unnamed-chunk-33-1.png" alt=""></p>
<p>The difference between true value and the last similated value</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">abs(beta[nbv]-mat.betahat2[length(vecN),])</span><br></pre></td></tr></table></figure>
<pre><code>## (Intercept)         smb         hml         rmw         cma 
##  0.04978255  0.32050856  0.61052734  0.68909783  0.92192545
</code></pre><h4 id="Plot-of-Error-Variance-of-omitting-model"><a href="#Plot-of-Error-Variance-of-omitting-model" class="headerlink" title="Plot of Error Variance of omitting model"></a>Plot of Error Variance of omitting model</h4><p>Unbised estimater of sigma^2</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># mypath &lt;- file.path(getwd(),&quot;Figure&quot;,&quot;vi_var_err.jpeg&quot;)</span></span><br><span class="line"><span class="comment"># jpeg(mypath, height = 8, width = 8, units = &apos;in&apos;, res = 300)</span></span><br><span class="line"><span class="comment"># bty for Box Style</span></span><br><span class="line">plot(vecN, vec.err.varh2, type=<span class="string">&quot;b&quot;</span>, xlab = <span class="string">&quot;#Replication&quot;</span>, ylab = <span class="string">&quot;Error Var.&quot;</span>, main = <span class="string">&quot;Model of omitting&quot;</span>)</span><br><span class="line">abline(h=sig2e, col = <span class="string">&quot;blue&quot;</span>, lty = <span class="number">2</span>)</span><br></pre></td></tr></table></figure>
<p><img src="/images/MC_FF5_files/figure-markdown_github/unnamed-chunk-35-1.png" alt=""></p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># dev.off()</span></span><br></pre></td></tr></table></figure>
<p>The difference between true value and the last similated value</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">abs(sig2e-vec.err.varh2[length(vecN)])</span><br></pre></td></tr></table></figure>
<pre><code>## [1] 1.113663
</code></pre><h1 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h1><h2 id="Monte-Carlo-Method"><a href="#Monte-Carlo-Method" class="headerlink" title="Monte Carlo Method"></a>Monte Carlo Method</h2><ul>
<li><a href="https://warwick.ac.uk/fac/sci/statistics/staff/academic-research/johansen/teaching/mcm-2007.pdf" target="_blank" rel="noopener">Monte Carlo Methods Lecture Notes by Adam M. Johansen and Ludger Evers, November 15, 2007</a></li>
<li>Machine Learning: The elegant way to extract information from data: <a href="https://events.mpifr-bonn.mpg.de/indico/event/30/material/slides/12.pdf" target="_blank" rel="noopener">Lecture notes on Regression: Markov Chain Monte Carlo (MCMC)</a><ul>
<li><a href="https://events.mpifr-bonn.mpg.de/indico/event/30/material/slides/" target="_blank" rel="noopener">All Slides</a></li>
</ul>
</li>
<li><a href="http://davegiles.blogspot.hk/2016/11/monte-carlo-simulation-basics-i.html" target="_blank" rel="noopener">Monte Carlo Simulation Basics, I: Historical Notes</a></li>
<li><a href="http://davegiles.blogspot.hk/2016/11/monte-carlo-simulation-basics-ii.html" target="_blank" rel="noopener">Monte Carlo Simulation Basics, II: Estimator Properties</a></li>
<li><a href="http://davegiles.blogspot.hk/2016/12/monte-carlo-simulation-basics-iii.html" target="_blank" rel="noopener">Monte Carlo Simulation Basics, III: Regression Model Estimators</a></li>
</ul>
<h2 id="Fama-French-Model"><a href="#Fama-French-Model" class="headerlink" title="Fama French Model"></a>Fama French Model</h2><h3 id="Intro"><a href="#Intro" class="headerlink" title="Intro"></a>Intro</h3><ul>
<li><a href="https://en.wikipedia.org/wiki/Fama%E2%80%93French_three-factor_model" target="_blank" rel="noopener">Fama-French three-factor model</a></li>
<li><a href="https://econometricswithr.wordpress.com/finance/how-to-download-portfolios-and-factors-from-fama-and-french-directly-within-r/" target="_blank" rel="noopener">How to Download Portfolios and Factors from Fama and French Directly into R</a></li>
<li><a href="https://econometricswithr.wordpress.com/finance/famafrenchme3/" target="_blank" rel="noopener">Estimate the Fama and French Three Factor Model</a></li>
<li><a href="http://www.calculatinginvestor.com/2011/04/19/fama-french-tutorial/" target="_blank" rel="noopener">Screencast: Fama-French Regression Tutorial Using R</a></li>
<li><a href="http://mba.tuck.dartmouth.edu/pages/faculty/ken.french/data_library.html" target="_blank" rel="noopener">ken.french</a></li>
<li><a href="https://quant.stackexchange.com/questions/26302/could-someone-teach-me-how-to-construct-the-portfolios-by-compute-like-using-r" target="_blank" rel="noopener">Could someone teach me how to construct the portfolios by compute (like using R, Excel or Eviews)</a></li>
</ul>
<h3 id="Tutorial"><a href="#Tutorial" class="headerlink" title="Tutorial"></a>Tutorial</h3><ul>
<li><a href="https://alphaarchitect.com/2011/08/01/how-to-use-the-fama-french-model/" target="_blank" rel="noopener">How to use the Fama French Model</a></li>
<li><a href="https://pdfs.semanticscholar.org/f97e/6a414c19d325cfd9e14de7bab6f8887c48fa.pdf" target="_blank" rel="noopener">Empirical tests of Fama-French three-factor model and Principle Component Analysis on the Chinese stock market</a></li>
<li><a href="https://www.quantconnect.com/tutorials/fama-french-multi-factor-models/" target="_blank" rel="noopener">Fama-French Multi-Factor Models</a></li>
<li><a href="https://github.com/alexpetralia/fama_french" target="_blank" rel="noopener">alexpetralia/fama_french</a></li>
<li><a href="http://mba.tuck.dartmouth.edu/pages/faculty/ken.french/Data_Library/f-f_factors.html" target="_blank" rel="noopener">Description of Fama/French Factors</a></li>
<li><a href="http://mba.tuck.dartmouth.edu/pages/faculty/ken.french/Data_Library/six_portfolios.html" target="_blank" rel="noopener">Detail for 6 Portfolios Formed on Size and Book-to-Market</a></li>
<li><a href="https://github.com/shabbychef/MarkowitzR" target="_blank" rel="noopener">shabbychef/MarkowitzR</a></li>
<li><a href="http://bulletin.engineering.nyu.edu/preview_course_nopop.php?catoid=5&amp;coid=14535" target="_blank" rel="noopener">FRE 7241 Algorithmic Portfolio Management</a><ul>
<li><a href="https://github.com/algoquant/lecture_slides" target="_blank" rel="noopener">GitHub</a></li>
<li><a href="https://github.com/algoquant/lecture_slides/blob/master/FRE_lecture_code.R" target="_blank" rel="noopener">lecture_slides/FRE_lecture_code.R</a></li>
</ul>
</li>
</ul>

      
    </div>
    
    
    

    <div>
    
      <div>
    
        <div style="text-align:center;color: #ccc;font-size:14px;">-------------End of post<i class="fa fa-flag"></i>Thanks for your time-------------</div>
    
</div>

    
    </div>

    
      <div>
        <div id="wechat_subscriber" style="display: block; padding: 10px 0; margin: 20px auto; width: 100%; text-align: center">
    <img id="wechat_subscriber_qcode" src="/qrcode_for_wechat_bdg.jpg" alt="BaoDuGe_飽蠹閣 wechat" style="width: 200px; max-width: 100%;">
    <div>Enjoy it? Subscribe to my blog by scanning my public wechat account</div>
</div>

      </div>
    

    

    
      <div>
        <ul class="post-copyright">
  <li class="post-copyright-author">
    <strong>Post author:</strong>
    BaoDuGe_飽蠹閣
  </li>
  <li class="post-copyright-link">
    <strong>Post link:</strong>
    <a href="http://blog.baoduge.com/MC_FF5/" title="Monte Carlo Experiment for Fama French 5 Factor Model">http://blog.baoduge.com/MC_FF5/</a>
  </li>
  <li class="post-copyright-license">
    <strong>Copyright Notice: </strong>
    All articles in this blog are licensed under <a href="https://creativecommons.org/licenses/by-nc-sa/3.0/" rel="external nofollow" target="_blank">CC BY-NC-SA 3.0</a> unless stating additionally.
  </li>
</ul>

      </div>
    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/rmarkdown/" rel="tag"># rmarkdown</a>
          
            <a href="/tags/rlang/" rel="tag"># rlang</a>
          
            <a href="/tags/experiment/" rel="tag"># experiment</a>
          
            <a href="/tags/monte-carlo/" rel="tag"># monte_carlo</a>
          
            <a href="/tags/famafrench/" rel="tag"># famafrench</a>
          
            <a href="/tags/statistics/" rel="tag"># statistics</a>
          
        </div>
      

      
      
        <div class="post-widgets">
        
          <div class="wp_rating">
            <div style="color:rgb(0, 0, 0); font-size:13px; letter-spacing:3px;">Rate this post</div>
            <div id="wpac-rating"></div>
          </div>
        

        
        </div>
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/MC_HP/" rel="next" title="Monte Carlo Experiment for House Pricing Prediction">
                <i class="fa fa-chevron-left"></i> Monte Carlo Experiment for House Pricing Prediction
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/rproject_hexo/" rel="prev" title="如何将我的R项目更好地展示在Hexo博客上？">
                如何将我的R项目更好地展示在Hexo博客上？ <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          
  <div class="comments" id="comments">
    
      <div id="disqus_thread">
        <noscript>
          Please enable JavaScript to view the
          <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a>
        </noscript>
      </div>
    
  </div>


        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
      <div id="sidebar-dimmer"></div>
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            Table of Contents
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview">
            Overview
          </li>
        </ul>
      

      <section class="site-overview sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope="" itemtype="http://schema.org/Person">
          
            <img class="site-author-image" itemprop="image" src="http://baoduge.com/My/avatar.gif" alt="BaoDuGe_飽蠹閣">
          
            <p class="site-author-name" itemprop="name">BaoDuGe_飽蠹閣</p>
            <p class="site-description motion-element" itemprop="description"></p>
        </div>

        <nav class="site-state motion-element">

          
            <div class="site-state-item site-state-posts">
            
              <a href="/archives">
            
                <span class="site-state-item-count">41</span>
                <span class="site-state-item-name">posts</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-categories">
              <a href="/categories/index.html">
                <span class="site-state-item-count">3</span>
                <span class="site-state-item-name">categories</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-tags">
              <a href="/tags/index.html">
                <span class="site-state-item-count">98</span>
                <span class="site-state-item-name">tags</span>
              </a>
            </div>
          

        </nav>

        
          <div class="feed-link motion-element">
            <a href="/atom.xml" rel="alternate">
              <i class="fa fa-rss"></i>
              RSS
            </a>
          </div>
        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/vincent27hugh" target="_blank" title="GitHub">
                  
                    <i class="fa fa-fw fa-github"></i>GitHub</a>
              </span>
            
              <span class="links-of-author-item">
                <a href="mailto:huweihugh@gmail.com" target="_blank" title="E-Mail">
                  
                    <i class="fa fa-fw fa-envelope"></i>E-Mail</a>
              </span>
            
          
        </div>

        
        

        
        
          <div class="links-of-blogroll motion-element links-of-blogroll-inline">
            <div class="links-of-blogroll-title">
              <i class="fa  fa-fw fa-globe"></i>
              Links
            </div>
            <ul class="links-of-blogroll-list">
              
                <li class="links-of-blogroll-item">
                  <a href="http://baoduge.com/" title="飽蠹閣BAODUGE" target="_blank">飽蠹閣BAODUGE</a>
                </li>
              
            </ul>
            
            <div id="days"></div>

<script language="javascript">
function show_date_time(){
window.setTimeout("show_date_time()", 1000);
BirthDay=new Date("09/08/2017 00:00:00");
today=new Date();
timeold=(today.getTime()-BirthDay.getTime());
sectimeold=timeold/1000
secondsold=Math.floor(sectimeold);
msPerDay=24*60*60*1000
e_daysold=timeold/msPerDay
daysold=Math.floor(e_daysold);
e_hrsold=(e_daysold-daysold)*24;
hrsold=setzero(Math.floor(e_hrsold));
e_minsold=(e_hrsold-hrsold)*60;
minsold=setzero(Math.floor((e_hrsold-hrsold)*60));
seconds=setzero(Math.floor((e_minsold-minsold)*60));
document.getElementById('days').innerHTML="Has been runing "+daysold+" Days "+hrsold+" Hours "+minsold+" Min "+seconds+" Sec ";
}
function setzero(i){
if (i<10)
{i="0" + i};
return i;
}
show_date_time();
</script>

          </div>
        

        <div id="days"></div>

<script language="javascript">
function show_date_time(){
window.setTimeout("show_date_time()", 1000);
BirthDay=new Date("09/08/2017 00:00:00");
today=new Date();
timeold=(today.getTime()-BirthDay.getTime());
sectimeold=timeold/1000
secondsold=Math.floor(sectimeold);
msPerDay=24*60*60*1000
e_daysold=timeold/msPerDay
daysold=Math.floor(e_daysold);
e_hrsold=(e_daysold-daysold)*24;
hrsold=setzero(Math.floor(e_hrsold));
e_minsold=(e_hrsold-hrsold)*60;
minsold=setzero(Math.floor((e_hrsold-hrsold)*60));
seconds=setzero(Math.floor((e_minsold-minsold)*60));
document.getElementById('days').innerHTML="Has been runing "+daysold+" Days "+hrsold+" Hours "+minsold+" Min "+seconds+" Sec ";
}
function setzero(i){
if (i<10)
{i="0" + i};
return i;
}
show_date_time();
</script>


      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#Model"><span class="nav-number">1.</span> <span class="nav-text">Model</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Data-Source"><span class="nav-number">2.</span> <span class="nav-text">Data Source</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Fama-French-3-Factors-Daily"><span class="nav-number">2.1.</span> <span class="nav-text">Fama/French 3 Factors [Daily]</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Portfolios-Formed-on-Book-to-Market-Daily"><span class="nav-number">2.2.</span> <span class="nav-text">Portfolios Formed on Book-to-Market [Daily]</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Load-Data"><span class="nav-number">3.</span> <span class="nav-text">Load Data</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Extract-Fama-French-Factors-and-Fund-Returns"><span class="nav-number">3.1.</span> <span class="nav-text">Extract Fama-French Factors and Fund Returns</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Run-Fama-French-Regression"><span class="nav-number">3.2.</span> <span class="nav-text">Run Fama-French Regression</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Monte-Carlo-Simulation"><span class="nav-number">4.</span> <span class="nav-text">Monte Carlo Simulation</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#One-example-of-Monte-Carlo-Simulation"><span class="nav-number">4.1.</span> <span class="nav-text">One example of Monte Carlo Simulation</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Running-Monte-Carlo-Simulation"><span class="nav-number">4.2.</span> <span class="nav-text">Running Monte Carlo Simulation</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Plot"><span class="nav-number">4.3.</span> <span class="nav-text">Plot</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Plot-of-density-of-estimator"><span class="nav-number">4.3.1.</span> <span class="nav-text">Plot of density of estimator</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Finding-i"><span class="nav-number">4.3.2.</span> <span class="nav-text">Finding (i)</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Plot-of-betahat"><span class="nav-number">4.3.2.1.</span> <span class="nav-text">Plot of betahat</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Plot-of-variance-of-betahat"><span class="nav-number">4.3.2.2.</span> <span class="nav-text">Plot of variance of betahat</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Plot-of-error-variance"><span class="nav-number">4.3.2.3.</span> <span class="nav-text">Plot of error variance</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Finding-ii"><span class="nav-number">4.3.3.</span> <span class="nav-text">Finding (ii)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Finding-iii"><span class="nav-number">4.3.4.</span> <span class="nav-text">Finding (iii)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Finding-iv"><span class="nav-number">4.3.5.</span> <span class="nav-text">Finding (iv)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Finding-v"><span class="nav-number">4.3.6.</span> <span class="nav-text">Finding (v)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Finding-vi"><span class="nav-number">4.3.7.</span> <span class="nav-text">Finding (vi)</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Plot-of-betahat-of-omitting-model"><span class="nav-number">4.3.7.1.</span> <span class="nav-text">Plot of betahat of omitting model</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Plot-of-Error-Variance-of-omitting-model"><span class="nav-number">4.3.7.2.</span> <span class="nav-text">Plot of Error Variance of omitting model</span></a></li></ol></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Reference"><span class="nav-number">5.</span> <span class="nav-text">Reference</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Monte-Carlo-Method"><span class="nav-number">5.1.</span> <span class="nav-text">Monte Carlo Method</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Fama-French-Model"><span class="nav-number">5.2.</span> <span class="nav-text">Fama French Model</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Intro"><span class="nav-number">5.2.1.</span> <span class="nav-text">Intro</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Tutorial"><span class="nav-number">5.2.2.</span> <span class="nav-text">Tutorial</span></a></li></ol></li></ol></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      
        <div class="back-to-top">
          <i class="fa fa-arrow-up"></i>
          
            <span id="scrollpercent"><span>0</span>%</span>
          
        </div>
      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">
  
  &copy;  2017 &mdash; 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">BaoDuGe_飽蠹閣</span>

  
</div>


  <div class="powered-by">Powered by <a class="theme-link" href="https://hexo.io">Hexo</a></div>

  <span class="post-meta-divider">|</span>

  <div class="theme-info">Theme &mdash; <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">NexT.Mist</a> v5.1.2</div>

  <div>
  <script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>

  Total Visits: <span id="busuanzi_value_site_pv"></span> &nbsp&nbsp&nbsp
  Total Visitors: <span id="busuanzi_value_site_uv"></span>
</div>




        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>

  
    <span class="site-uv">
      <i class="fa fa-user"></i>
      <span class="busuanzi-value" id="busuanzi_value_site_uv"></span>
      
    </span>
  

  
    <span class="site-pv">
      <i class="fa fa-eye"></i>
      <span class="busuanzi-value" id="busuanzi_value_site_pv"></span>
      
    </span>
  
</div>








        
      </div>
    </footer>

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  


  











  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>

  
  <script type="text/javascript" src="/lib/canvas-nest/canvas-nest.min.js"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.2"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.2"></script>



  
  

  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.2"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.2"></script>


  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.2"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.2"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.2"></script>



  


  

    
      <script id="dsq-count-scr" src="https://baoduge.disqus.com/count.js" async></script>
    

    
      <script type="text/javascript">
        var disqus_config = function () {
          this.page.url = 'http://blog.baoduge.com/MC_FF5/';
          this.page.identifier = 'MC_FF5/';
          this.page.title = 'Monte Carlo Experiment for Fama French 5 Factor Model';
        };
        var d = document, s = d.createElement('script');
        s.src = 'https://baoduge.disqus.com/embed.js';
        s.setAttribute('data-timestamp', '' + +new Date());
        (d.head || d.body).appendChild(s);
      </script>
    

  













  

  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url);
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('5');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





  

  
  <script src="https://cdn1.lncld.net/static/js/av-core-mini-0.6.4.js"></script>
  <script>AV.initialize("EkPIkYolbkzKanbzn4mNKpf7-gzGzoHsz", "lP1WbRwpyyu9r1NAqva2xWmS");</script>
  <script>
    function showTime(Counter) {
      var query = new AV.Query(Counter);
      var entries = [];
      var $visitors = $(".leancloud_visitors");

      $visitors.each(function () {
        entries.push( $(this).attr("id").trim() );
      });

      query.containedIn('url', entries);
      query.find()
        .done(function (results) {
          var COUNT_CONTAINER_REF = '.leancloud-visitors-count';

          if (results.length === 0) {
            $visitors.find(COUNT_CONTAINER_REF).text(0);
            return;
          }

          for (var i = 0; i < results.length; i++) {
            var item = results[i];
            var url = item.get('url');
            var time = item.get('time');
            var element = document.getElementById(url);

            $(element).find(COUNT_CONTAINER_REF).text(time);
          }
          for(var i = 0; i < entries.length; i++) {
            var url = entries[i];
            var element = document.getElementById(url);
            var countSpan = $(element).find(COUNT_CONTAINER_REF);
            if( countSpan.text() == '') {
              countSpan.text(0);
            }
          }
        })
        .fail(function (object, error) {
          console.log("Error: " + error.code + " " + error.message);
        });
    }

    function addCount(Counter) {
      var $visitors = $(".leancloud_visitors");
      var url = $visitors.attr('id').trim();
      var title = $visitors.attr('data-flag-title').trim();
      var query = new AV.Query(Counter);

      query.equalTo("url", url);
      query.find({
        success: function(results) {
          if (results.length > 0) {
            var counter = results[0];
            counter.fetchWhenSave(true);
            counter.increment("time");
            counter.save(null, {
              success: function(counter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(counter.get('time'));
              },
              error: function(counter, error) {
                console.log('Failed to save Visitor num, with error message: ' + error.message);
              }
            });
          } else {
            var newcounter = new Counter();
            /* Set ACL */
            var acl = new AV.ACL();
            acl.setPublicReadAccess(true);
            acl.setPublicWriteAccess(true);
            newcounter.setACL(acl);
            /* End Set ACL */
            newcounter.set("title", title);
            newcounter.set("url", url);
            newcounter.set("time", 1);
            newcounter.save(null, {
              success: function(newcounter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(newcounter.get('time'));
              },
              error: function(newcounter, error) {
                console.log('Failed to create');
              }
            });
          }
        },
        error: function(error) {
          console.log('Error:' + error.code + " " + error.message);
        }
      });
    }

    $(function() {
      var Counter = AV.Object.extend("Counter");
      if ($('.leancloud_visitors').length == 1) {
        addCount(Counter);
      } else if ($('.post-title-link').length > 1) {
        showTime(Counter);
      }
    });
  </script>



  

  
  <script type="text/javascript">
  wpac_init = window.wpac_init || [];
  wpac_init.push({widget: 'Rating', id: 7746,
    el: 'wpac-rating',
    color: 'fc6423'
  });
  (function() {
    if ('WIDGETPACK_LOADED' in window) return;
    WIDGETPACK_LOADED = true;
    var mc = document.createElement('script');
    mc.type = 'text/javascript';
    mc.async = true;
    mc.src = '//embed.widgetpack.com/widget.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(mc, s.nextSibling);
  })();
  </script>


  
  
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        tex2jax: {
          inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
          processEscapes: true,
          skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
        }
      });
    </script>

    <script type="text/x-mathjax-config">
      MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for (i=0; i < all.length; i += 1) {
          all[i].SourceElement().parentNode.className += ' has-jax';
        }
      });
    </script>
    <script type="text/javascript" src="//cdn.bootcss.com/mathjax/2.7.1/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
  


  

  

</body>
</html>
